(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{217:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return s})),t.d(a,"metadata",(function(){return c})),t.d(a,"rightToc",(function(){return i})),t.d(a,"default",(function(){return p}));var n=t(3),o=t(7),r=(t(0),t(232)),s={id:"offline_installation",title:"Offline Installation"},c={unversionedId:"user_guides/offline_installation",id:"user_guides/offline_installation",isDocsHomePage:!1,title:"Offline Installation",description:"This document describes how to install Chaos Mesh in an offline environment.",source:"@site/docs/user_guides/offline_installation.md",slug:"/user_guides/offline_installation",permalink:"/docs/next/user_guides/offline_installation",editUrl:"https://github.com/chaos-mesh/website/edit/master/docs/user_guides/offline_installation.md",version:"current",sidebar:"docs",previous:{title:"Installation",permalink:"/docs/next/user_guides/installation"},next:{title:"Define the Scope of Chaos Experiment",permalink:"/docs/next/user_guides/experiment_scope"}},i=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Prepare the installation file",id:"prepare-the-installation-file",children:[]},{value:"Install Chaos Mesh offline",id:"install-chaos-mesh-offline",children:[]}],l={rightToc:i};function p(e){var a=e.components,t=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},l,t,{components:a,mdxType:"MDXLayout"}),Object(r.b)("p",null,"This document describes how to install Chaos Mesh in an offline environment."),Object(r.b)("h2",{id:"prerequisites"},"Prerequisites"),Object(r.b)("p",null,"Before deploying Chaos Mesh, make sure the following items have been installed:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Kubernetes version >= 1.12"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",Object(n.a)({parentName:"li"},{href:"https://kubernetes.io/docs/admin/authorization/rbac"}),"RBAC")," enabled (optional)"),Object(r.b)("li",{parentName:"ul"},"Docker")),Object(r.b)("h2",{id:"prepare-the-installation-file"},"Prepare the installation file"),Object(r.b)("p",null,"To install Chaos Mesh offline, you need to get the installation images via an internet connection. Take the steps below:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Specify the version you want to install:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),'export CHAOS_MESH_VERSION="v1.1.0"\n')),Object(r.b)("blockquote",{parentName:"li"},Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Note:")),Object(r.b)("p",{parentName:"blockquote"},"It is recommended that you use a stable release, or you can set the version to ",Object(r.b)("inlineCode",{parentName:"p"},"latest")," if you want to experience the latest features that are under development."))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Archive the docker images of Chaos Mesh:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash",metastring:"#pull images of Chaos Mesh","#pull":!0,images:!0,of:!0,Chaos:!0,Mesh:!0}),"docker pull pingcap/chaos-mesh:${CHAOS_MESH_VERSION}\ndocker pull pingcap/chaos-daemon:${CHAOS_MESH_VERSION}\ndocker pull pingcap/chaos-dashboard:${CHAOS_MESH_VERSION}\n")),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash",metastring:"#save images of Chaos Mesh to files","#save":!0,images:!0,of:!0,Chaos:!0,Mesh:!0,to:!0,files:!0}),"docker save -o ./image-chaos-mesh pingcap/chaos-mesh:${CHAOS_MESH_VERSION}\ndocker save -o ./image-chaos-daemon pingcap/chaos-daemon:${CHAOS_MESH_VERSION}\ndocker save -o ./image-chaos-dashboard pingcap/chaos-dashboard:${CHAOS_MESH_VERSION}\n"))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Download the Chaos Mesh repository to your local:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),'wget "https://github.com/chaos-mesh/chaos-mesh/archive/${CHAOS_MESH_VERSION}.zip"\n')),Object(r.b)("p",{parentName:"li"},"Or you can download the latest unstable version:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"wget https://github.com/chaos-mesh/chaos-mesh/archive/master.zip\n"))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Copy the ./image-chaos-mesh",Object(r.b)("inlineCode",{parentName:"p"},", "),"./image-chaos-daemon",Object(r.b)("inlineCode",{parentName:"p"},", "),"./image-chaos-dashboard",Object(r.b)("inlineCode",{parentName:"p"},"and"),"{CHAOS_MESH_VERSION}.zip` into the offline environment."))),Object(r.b)("h2",{id:"install-chaos-mesh-offline"},"Install Chaos Mesh offline"),Object(r.b)("p",null,"Now that you already have the image and repo archive files in the offline environment, start installing Chaos Mesh."),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Specify the version you are going to install in the offline environment:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),'export CHAOS_MESH_VERSION="v1.1.0"\n'))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Load the image from the archive files:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"docker load -i ./image-chaos-mesh\ndocker load -i ./image-chaos-daemon\ndocker load -i ./image-chaos-dashboard\n"))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Push the Chaos Mesh images. You can choose to push them to Docker Registry or Docker Hub."),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Push images to Docker Registry"),Object(r.b)("p",{parentName:"li"},"a. Set the Docker Registry variable, for example:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"export DOCKER_REGISTRY=localhost:5000\n")),Object(r.b)("p",{parentName:"li"},"b. Tag these images with ",Object(r.b)("inlineCode",{parentName:"p"},"$DOCKER_REGISTRY"),":"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"export CHAOS_MESH_IMAGE=$DOCKER_REGISTRY/pingcap/chaos-mesh:${CHAOS_MESH_VERSION}\nexport CHAOS_DAEMON_IMAGE=$DOCKER_REGISTRY/pingcap/chaos-daemon:${CHAOS_MESH_VERSION}\nexport CHAOS_DASHBOARD_IMAGE=$DOCKER_REGISTRY/pingcap/chaos-dashboard:${CHAOS_MESH_VERSION}\ndocker image tag pingcap/chaos-mesh:${CHAOS_MESH_VERSION} $CHAOS_MESH_IMAGE\ndocker image tag pingcap/chaos-daemon:${CHAOS_MESH_VERSION} $CHAOS_DAEMON_IMAGE\ndocker image tag pingcap/chaos-dashboard:${CHAOS_MESH_VERSION} $CHAOS_DASHBOARD_IMAGE\n")),Object(r.b)("p",{parentName:"li"},"c. Push these images to Docker Registry:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"docker push $CHAOS_MESH_IMAGE\ndocker push $CHAOS_DAEMON_IMAGE\ndocker push $CHAOS_DASHBOARD_IMAGE\n")),Object(r.b)("blockquote",{parentName:"li"},Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Note:")),Object(r.b)("p",{parentName:"blockquote"},"If the Docker Registry can only work locally, you need to load and push these images on each K8s node."))),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Push images to Docker Hub"),Object(r.b)("p",{parentName:"li"},"a. Set the Docker Hub variable, for example:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"export DOCKER_HUB=hub\n")),Object(r.b)("p",{parentName:"li"},"b. Tag these images with ",Object(r.b)("inlineCode",{parentName:"p"},"$DOCKER_REGISTRY"),":"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"export CHAOS_MESH_IMAGE=$DOCKER_HUB/chaos-mesh:${CHAOS_MESH_VERSION}\nexport CHAOS_DAEMON_IMAGE=$DOCKER_HUB/chaos-daemon:${CHAOS_MESH_VERSION}\nexport CHAOS_DASHBOARD_IMAGE=$DOCKER_HUB/chaos-dashboard:${CHAOS_MESH_VERSION}\ndocker image tag pingcap/chaos-mesh:${CHAOS_MESH_VERSION} $CHAOS_MESH_IMAGE\ndocker image tag pingcap/chaos-daemon:${CHAOS_MESH_VERSION} $CHAOS_DAEMON_IMAGE\ndocker image tag pingcap/chaos-dashboard:${CHAOS_MESH_VERSION} $CHAOS_DASHBOARD_IMAGE\n")),Object(r.b)("p",{parentName:"li"},"c. Push these images to Docker Registry:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"docker push $CHAOS_MESH_IMAGE\ndocker push $CHAOS_DAEMON_IMAGE\ndocker push $CHAOS_DASHBOARD_IMAGE\n"))))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Install Chaos Mesh offline with the following steps:"),Object(r.b)("p",{parentName:"li"},"a. Unzip the repo archive files to a path:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"unzip {CHAOS_MESH_VERSION}.zip chaos-mesh && cd chaos-mesh/*/\n")),Object(r.b)("p",{parentName:"li"},"b. Create a namespace for installing Chaos Mesh:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"kubectl create namespace chaos-testing\n")),Object(r.b)("p",{parentName:"li"},"c. Install Chaos Mesh by helm:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"helm install chaos-mesh helm/chaos-mesh  --namespace=chaos-testing \\\n   --set dashboard.create=true \\\n   --set chaosDaemon.image=$CHAOS_DAEMON_IMAGE \\\n   --set controllerManager.image=$CHAOS_MESH_IMAGE \\\n   --set dashboard.image=$CHAOS_DASHBOARD_IMAGE\n")),Object(r.b)("p",{parentName:"li"},"d. Check whether Chaos Mesh pods are installed:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash",metastring:"#get pods of Chaos Mesh","#get":!0,pods:!0,of:!0,Chaos:!0,Mesh:!0}),"kubectl get pods --namespace chaos-testing -l app.kubernetes.io/instance=chaos-mesh\n")),Object(r.b)("p",{parentName:"li"},"Expected output:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"NAME                                        READY   STATUS    RESTARTS   AGE\nchaos-controller-manager-6d6d95cd94-kl8gs   1/1     Running   0          3m40s\nchaos-daemon-5shkv                          1/1     Running   0          3m40s\nchaos-dashboard-d998856f6-vgrjs             1/1     Running   0          3m40s\n")),Object(r.b)("p",{parentName:"li"},"After executing the above commands, you should be able to see the output indicating that all Chaos Mesh pods are up and running. Otherwise, check the current environment according to the prompt message or create an ",Object(r.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/chaos-mesh/chaos-mesh/issues"}),"issue")," for help."))))}p.isMDXComponent=!0},232:function(e,a,t){"use strict";t.d(a,"a",(function(){return b})),t.d(a,"b",(function(){return O}));var n=t(0),o=t.n(n);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function c(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,n,o=function(e,a){if(null==e)return{};var t,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=o.a.createContext({}),p=function(e){var a=o.a.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):c(c({},a),e)),t},b=function(e){var a=p(e.components);return o.a.createElement(l.Provider,{value:a},e.children)},h={inlineCode:"code",wrapper:function(e){var a=e.children;return o.a.createElement(o.a.Fragment,{},a)}},m=o.a.forwardRef((function(e,a){var t=e.components,n=e.mdxType,r=e.originalType,s=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),b=p(t),m=n,O=b["".concat(s,".").concat(m)]||b[m]||h[m]||r;return t?o.a.createElement(O,c(c({ref:a},l),{},{components:t})):o.a.createElement(O,c({ref:a},l))}));function O(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var r=t.length,s=new Array(r);s[0]=m;var c={};for(var i in a)hasOwnProperty.call(a,i)&&(c[i]=a[i]);c.originalType=e,c.mdxType="string"==typeof e?e:n,s[1]=c;for(var l=2;l<r;l++)s[l]=t[l];return o.a.createElement.apply(null,s)}return o.a.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);