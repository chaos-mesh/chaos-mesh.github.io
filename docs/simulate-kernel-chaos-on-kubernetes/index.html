<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Chaos MeshÂ® Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Chaos MeshÂ® Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-90760217-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Chaos MeshÂ®" href="/opensearch.xml"><title data-react-helmet="true">Simulate Linux Kernel Faults | Chaos MeshÂ®</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://chaos-mesh.org/docs/simulate-kernel-chaos-on-kubernetes"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="2.0.0"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-2.0.0"><meta data-react-helmet="true" property="og:title" content="Simulate Linux Kernel Faults | Chaos MeshÂ®"><meta data-react-helmet="true" name="description" content="This document describes how to use KernelChaos to simulate Linux kernel faults. This feature injects I/O-based or memory-based faults into the specified kernel paths using BPF."><meta data-react-helmet="true" property="og:description" content="This document describes how to use KernelChaos to simulate Linux kernel faults. This feature injects I/O-based or memory-based faults into the specified kernel paths using BPF."><meta data-react-helmet="true" property="og:image" content="https://chaos-mesh.org/img/logos/logo-mini.svg"><meta data-react-helmet="true" name="twitter:image" content="https://chaos-mesh.org/img/logos/logo-mini.svg"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chaos-mesh.org/docs/simulate-kernel-chaos-on-kubernetes"><link data-react-helmet="true" rel="alternate" href="https://chaos-mesh.org/docs/simulate-kernel-chaos-on-kubernetes" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://chaos-mesh.org/docs/simulate-kernel-chaos-on-kubernetes" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.5b15a2c7.css">
<link rel="preload" href="/assets/js/runtime~main.20db57eb.js" as="script">
<link rel="preload" href="/assets/js/main.c0d4da0f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logos/logo-mini.svg" alt="Chaos Mesh Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logos/logo-mini-white.svg" alt="Chaos Mesh Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Chaos MeshÂ®</b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">2.0.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/simulate-kernel-chaos-on-kubernetes">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/simulate-kernel-chaos-on-kubernetes">2.0.0</a></li><li><a class="dropdown__link" href="/docs/1.2.3/">1.2.3</a></li><li><a class="dropdown__link" href="/docs/1.1.4/">1.1.4</a></li><li><a class="dropdown__link" href="/docs/1.0.3/">1.0.3</a></li><li><a class="dropdown__link" href="/docs/0.9.1/">0.9.1</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Documentation</a><a class="navbar__item navbar__link" href="/interactive-tutorial">Interactive Tutorial</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://community.cncf.io/chaos-mesh-community/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://chaos-mesh.org/website-zh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>ä¸­æ–‡<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logos/logo-mini.svg" alt="Chaos Mesh Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logos/logo-mini-white.svg" alt="Chaos Mesh Logo" class="themedImage_1VuW themedImage--dark_hz6m"><b>Chaos MeshÂ®</b></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">About Chaos Mesh</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Installation and Deployment</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/quick-start">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/production-installation-using-helm">Install Chaos Mesh using Helm</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/offline-installation">Install Chaos Mesh Offline</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Manage Roles</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Run a Single Chaos Experiment</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0"> Orchestrate Multiple Chaos Experiments</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Types of Chaos Experiments</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Kubernetes</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/simulate-pod-chaos-on-kubernetes">Simulate Pod Faults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/simulate-network-chaos-on-kubernetes">Simulate Network Faults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/simulate-heavy-stress-on-kubernetes">Simulate Stress Scenarios</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/simulate-io-chaos-on-kubernetes">Simulate File I/O Faults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/simulate-dns-chaos-on-kubernetes">Simulate DNS Faults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/simulate-time-chaos-on-kubernetes">Simulate Time Faults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/simulate-jvm-application-chaos">Simulate JVM Application Faults</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/simulate-kernel-chaos-on-kubernetes">Simulate Linux Kernel Faults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/simulate-aws-chaos">Simulate AWS Faults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/simulate-gcp-chaos">Simulate GCP Faults</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/simulate-http-chaos-on-kubernetes">Simulate HTTP faults</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Physical Nodes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tools Integration</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Development Guides</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQs and Troubleshooting</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><span class="badge badge--secondary">Version: 2.0.0</span><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Simulate Linux Kernel Faults</h1></header><p>This document describes how to use KernelChaos to simulate Linux kernel faults. This feature injects I/O-based or memory-based faults into the specified kernel paths using <a href="https://lore.kernel.org/lkml/20171213180356.hsuhzoa7s4ngro2r@destiny/T/" target="_blank" rel="noopener noreferrer">BPF</a>.</p><p>Although you can set the injection target of KernelChaos to one or several Pods, the performance of other Pods on the host will be affected, because all Pods share the same kernel.</p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>The simulation of Linux kernel faults is disabled by default. Do not use this feature in a production environment.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li>Linux kernel version &gt;= 4.18.</li><li>The Linux kernel configuration <a href="https://cateee.net/lkddb/web-lkddb/BPF_KPROBE_OVERRIDE.html" target="_blank" rel="noopener noreferrer">CONFOG_BPF_KPROBE_OVERRIDE</a> is enabled.</li><li>The <code>bpfki.create</code> configuration value in <a href="https://github.com/chaos-mesh/chaos-mesh/blob/master/helm/chaos-mesh/values.yaml" target="_blank" rel="noopener noreferrer">values.yaml</a> is <code>true</code>.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="configuration-file"></a>Configuration file<a class="hash-link" href="#configuration-file" title="Direct link to heading">#</a></h2><p>A simple KernelChaos configuration file is as follows:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_6upA thin-scrollbar"><div class="codeBlockLines_xlV7" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> chaos</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">mesh.org/v1alpha1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> KernelChaos</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> kernel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">chaos</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">example</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> chaos</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">testing</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> one</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">namespaces</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> chaos</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">mount</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">failKernRequest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">callchain</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">funcname</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;__x64_sys_mount&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">failtype</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i">Copy</button></div></div><p>For more configuration examples, refer to <a href="https://github.com/chaos-mesh/chaos-mesh/tree/master/examples" target="_blank" rel="noopener noreferrer">examples</a>. You can modify these configuration examples as needed.</p><p>Configuration description:</p><ul><li><p><strong>mode</strong> specifies how the experiment runs. The options are as follows:</p><ul><li><code>one</code>: randomly selects an eligible Pod.</li><li><code>all</code>: selects all eligible Pods.</li><li><code>fixed</code>: selects a specified number of eligible Pods.</li><li><code>fixed-percent</code>: selects a specified percentage of eligible Pods.</li><li><code>random-max-percent</code>: selects the maximum percentage of eligible Pods.</li></ul></li><li><p><strong>selector</strong> specifies the target Pod for fault injection.</p></li><li><p><strong>FailedkernRequest</strong> specifies the fault mode (such as kmallo and bio). It also specifies a specific call chain path and the optional filtering conditions. The configuration items are as follows:</p><ul><li><p><strong>Failtype</strong> specifies the fault type. The value options are as follows:</p><ul><li>&#x27;0&#x27;: injects the slab allocation error should_failslab.</li><li>&#x27;1&#x27;: injects the memory page allocation error should_fail_alloc_page.</li><li>&#x27;2&#x27;: injects the bio error should_fail_bio.</li></ul><p>For more information on these three fault types, refer to <a href="https://www.kernel.org/doc/html/latest/fault-injection/fault-injection.html" target="_blank" rel="noopener noreferrer">fault-injection</a> and <a href="http://github.com/iovisor/bcc/blob/master/tools/inject_example.txt" target="_blank" rel="noopener noreferrer">inject_example</a>.</p></li><li><p><strong>Callchain</strong> specifies a specific call chain. For example:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W c"><div tabindex="0" class="prism-code language-c codeBlock_6upA thin-scrollbar"><div class="codeBlockLines_xlV7" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">ext4_mount</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">-&gt;</span><span class="token plain"> mount_subtree</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">-&gt;</span><span class="token plain"> should_failslab</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i">Copy</button></div></div><p>You can also use the function parameters as filtering rules to inject more fine-grained faults. Refer to <a href="https://github.com/chaos-mesh/bpfki/tree/develop/examples" target="_blank" rel="noopener noreferrer">call chain and predicate examples</a> for more information. If no call chain is specified, keep the <code>callchain</code> field empty, indicating that faults will be injected to any path on which slab alloc is called (for example, kmallo).</p><p>The call chain type is a frame array, consisting of the following three parts:</p><ul><li><strong>funcname</strong>, which can be found from the kernel source code or from <code>/proc/kallsyms</code>, such as <code>ext4_mount</code>.</li><li><strong>parameters</strong>, which is used for filtering. If you want to inject a slab error on the <code>d_alloc_parallel(struct dentry *parent, const struct qstr *name)</code> with a special name <code>bananas</code> path, you need to set the <code>parameters</code> to <code>struct dentry *parent, const struct qstr *name</code>. Otherwise, omit this configuration.</li><li><strong>predicate</strong>, which is used to access the parameters of the frame array. Taking <strong>parameters</strong> as an example, you can set it to <code>STRNCMP(name-&gt;name, &quot;bananas&quot;, 8)</code> to control the path of fault injection, or you can leave it empty for all call paths that execute <code>d_allo_parallel</code> receive the slab fault injection.</li></ul></li><li><p><strong>headers</strong> specifies the kernel header file you need. For example, &quot;linux/mmzone.h&quot; and &quot;linux/blkdev.h&quot;.</p></li><li><p><strong>probability</strong> specifies the probability of faults. If you want the probability of 1%, set to &#x27;1&#x27;.</p></li><li><p><strong>times</strong> specifies the maximum number of times a fault is triggered.</p></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="create-an-experiment-using-kubectl"></a>Create an experiment using kubectl<a class="hash-link" href="#create-an-experiment-using-kubectl" title="Direct link to heading">#</a></h2><p>Use <code>kubectl</code> to create an experiment:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W bash"><div tabindex="0" class="prism-code language-bash codeBlock_6upA thin-scrollbar"><div class="codeBlockLines_xlV7" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl apply -f KernelChaos</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i">Copy</button></div></div><p>The KernelChaos feature is similar to <a href="https://github.com/iovisor/bcc/blob/master/tools/inject.py" target="_blank" rel="noopener noreferrer">inject.py</a>. For more information, refer to <a href="https://github.com/iovisor/bcc/blob/master/tools/inject_example.txt" target="_blank" rel="noopener noreferrer">input_example.txt</a>.</p><p>A simple example is as follows:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W c"><div tabindex="0" class="prism-code language-c codeBlock_6upA thin-scrollbar"><div class="codeBlockLines_xlV7" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(189, 147, 249);font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(255, 121, 198)">&lt;sys/mount.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(189, 147, 249);font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(255, 121, 198)">&lt;stdio.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(189, 147, 249);font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(255, 121, 198)">&lt;string.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(189, 147, 249);font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(255, 121, 198)">&lt;errno.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:rgb(189, 147, 249);font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(255, 121, 198)">&lt;unistd.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">main</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    ret </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/dev/sdc&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/mnt&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ext4&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          MS_MGC_VAL </span><span class="token operator">|</span><span class="token plain"> MS_RDONLY </span><span class="token operator">|</span><span class="token plain"> MS_NOSUID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ret </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token function" style="color:rgb(80, 250, 123)">fprintf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token constant" style="color:rgb(189, 147, 249)">stderr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;%s\n&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">strerror</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">errno</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sleep</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    ret </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">umount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/mnt&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ret </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token function" style="color:rgb(80, 250, 123)">fprintf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token constant" style="color:rgb(189, 147, 249)">stderr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;%s\n&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">strerror</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">errno</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i">Copy</button></div></div><p>During the fault injection, the output is as follows:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W"><div tabindex="0" class="prism-code language-undefined codeBlock_6upA thin-scrollbar"><div class="codeBlockLines_xlV7" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; Cannot allocate memory</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; Invalid argument</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; Cannot allocate memory</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; Invalid argument</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; Cannot allocate memory</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; Invalid argument</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; Cannot allocate memory</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; Invalid argument</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; Cannot allocate memory</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">&gt; Invalid argument</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="usage-restriction"></a>Usage restriction<a class="hash-link" href="#usage-restriction" title="Direct link to heading">#</a></h2><p>You can use container_id to limit the scope of the fault injection, but some paths trigger system-level behaviors. For example:</p><p>When <code>failtype</code> is <code>1</code>, it means that the physical page allocation fails. If this event is frequently triggered within a short period of time (for example, <code>while (1) {memset(malloc(1M), &#x27;1&#x27;, 1M)}</code>), the oom-killer system call is triggered to recycle memory.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/chaos-mesh/website/edit/master/versioned_docs/version-2.0.0/simulate-kernel-chaos-on-kubernetes.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/simulate-jvm-application-chaos"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Simulate JVM Application Faults</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/simulate-aws-chaos"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Simulate AWS Faults Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#configuration-file" class="table-of-contents__link">Configuration file</a></li><li><a href="#create-an-experiment-using-kubectl" class="table-of-contents__link">Create an experiment using kubectl</a></li><li><a href="#usage-restriction" class="table-of-contents__link">Usage restriction</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/get_started/get_started_on_kind">Get Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/user_guides/installation">User Guides</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/chaos_mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.cncf.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack (#project-chaos-mesh)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://community.cncf.io/chaos-mesh-community/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Others</div><ul class="footer__items"><li class="footer__item"><a href="https://www.netlify.com"><img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>Â© Chaos MeshÂ® Authors 2021 | Documentation Distributed under CC-BY-4.0 </strong>
        <br>
        <br>
        Â© 2021 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.
      </div></div></div></footer></div>
<script src="/assets/js/runtime~main.20db57eb.js"></script>
<script src="/assets/js/main.c0d4da0f.js"></script>
</body>
</html>