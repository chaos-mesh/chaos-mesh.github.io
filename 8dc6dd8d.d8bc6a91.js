(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{135:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return b}));var a=n(2),o=n(6),r=(n(0),n(150)),i={id:"run_your_first_chaos_experiment",title:"Run Your First Chaos Experiment in 10 Minutes",author:"Cwen Yin",author_title:"Maintainer of Chaos Mesh",author_url:"https://github.com/cwen0",author_image_url:"https://avatars1.githubusercontent.com/u/22956341?v=4",tags:["Chaos Mesh","Chaos Engineering","Kubernetes"]},s={permalink:"/blog/run_your_first_chaos_experiment",editUrl:"https://github.com/pingcap/chaos-mesh/edit/master/website/blog/blog/2020-03-18-run-your-first-chaos-experiment.md",source:"@site/blog/2020-03-18-run-your-first-chaos-experiment.md",description:"!Run your first chaos experiment in 10 minutes",date:"2020-03-18T00:00:00.000Z",tags:[{label:"Chaos Mesh",permalink:"/blog/tags/chaos-mesh"},{label:"Chaos Engineering",permalink:"/blog/tags/chaos-engineering"},{label:"Kubernetes",permalink:"/blog/tags/kubernetes"}],title:"Run Your First Chaos Experiment in 10 Minutes",readingTime:5.735,truncated:!0,prevItem:{title:"Simulating Clock Skew in K8s Without Affecting Other Containers on the Node",permalink:"/blog/simulating-clock-skew-in-k8s-without-affecting-other-containers-on-node"},nextItem:{title:"Chaos Mesh - Your Chaos Engineering Solution for System Resiliency on Kubernetes",permalink:"/blog/chaos_mesh_your_chaos_engineering_solution"}},c=[{value:"A preview of our little experiment",id:"a-preview-of-our-little-experiment",children:[]},{value:"Let&#39;s get started!",id:"lets-get-started",children:[{value:"Prepare the environment",id:"prepare-the-environment",children:[]},{value:"Deploy the application",id:"deploy-the-application",children:[]},{value:"Create the chaos experiment",id:"create-the-chaos-experiment",children:[]},{value:"Delete the chaos experiment",id:"delete-the-chaos-experiment",children:[]},{value:"Delete Kubernetes clusters",id:"delete-kubernetes-clusters",children:[]}]},{value:"Cool! What&#39;s next?",id:"cool-whats-next",children:[]}],l={rightToc:c};function b(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/run-first-chaos-experiment-in-ten-minutes.jpg",alt:"Run your first chaos experiment in 10 minutes"}))),Object(r.b)("p",null,"Chaos Engineering is a way to test a production software system's robustness by simulating unusual or disruptive conditions. For many people, however, the transition from learning Chaos Engineering to practicing it on their own systems is daunting. It sounds like one of those big ideas that require a fully-equipped team to plan ahead. Well, it doesn't have to be. To get started with chaos experimenting, you may be just one suitable platform away."),Object(r.b)("p",null,Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/pingcap/chaos-mesh"}),"Chaos Mesh")," is an ",Object(r.b)("strong",{parentName:"p"},"easy-to-use"),", open-source, cloud-native Chaos Engineering platform that orchestrates chaos in Kubernetes environments. This 10-minute tutorial will help you quickly get started with Chaos Engineering and run your first chaos experiment with Chaos Mesh."),Object(r.b)("p",null,"For more information about Chaos Mesh, refer to our ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://pingcap.com/blog/chaos-mesh-your-chaos-engineering-solution-for-system-resiliency-on-kubernetes/"}),"previous article")," or the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/pingcap/chaos-mesh"}),"chaos-mesh project")," on GitHub."),Object(r.b)("h2",{id:"a-preview-of-our-little-experiment"},"A preview of our little experiment"),Object(r.b)("p",null,"Chaos experiments are similar to experiments we do in a science class. It's perfectly fine to stimulate turbulent situations in a controlled environment. In our case here, we will be simulating network chaos on a small web application called ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/chaos-mesh/web-show"}),"web-show"),". To visualize the chaos effect, web-show records the latency from its pod to the kube-controller pod (under the namespace of ",Object(r.b)("inlineCode",{parentName:"p"},"kube-system"),") every 10 seconds."),Object(r.b)("p",null,"The following clip shows the process of installing Chaos Mesh, deploying web-show, and creating the chaos experiment within a few commands:"),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/whole-process-of-chaos-experiment.gif",alt:"The whole process of the chaos experiment"}))),Object(r.b)("div",{class:"caption-center"}," The whole process of the chaos experiment "),Object(r.b)("p",null,"Now it's your turn! It's time to get your hands dirty."),Object(r.b)("h2",{id:"lets-get-started"},"Let's get started!"),Object(r.b)("p",null,"For our simple experiment, we use Kubernetes in the Docker (",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://kind.sigs.k8s.io/"}),"Kind"),") for Kubernetes development. You can feel free to use ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://minikube.sigs.k8s.io/"}),"Minikube")," or any existing Kubernetes clusters to follow along."),Object(r.b)("h3",{id:"prepare-the-environment"},"Prepare the environment"),Object(r.b)("p",null,"Before moving forward, make sure you have ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://git-scm.com/"}),"Git")," and ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.docker.com/"}),"Docker")," installed on your local computer, with Docker up and running. For macOS, it's recommended to allocate at least 6 CPU cores to Docker. For details, see ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.docker.com/docker-for-mac/#advanced"}),"Docker configuration for Mac"),"."),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Get Chaos Mesh:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"git clone https://github.com/pingcap/chaos-mesh.git\ncd chaos-mesh/\n"))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Install Chaos Mesh with the ",Object(r.b)("inlineCode",{parentName:"p"},"install.sh")," script:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"./install.sh --local kind\n")),Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"install.sh")," is an automated shell script that checks your environment, installs Kind, launches Kubernetes clusters locally, and deploys Chaos Mesh. To see the detailed description of ",Object(r.b)("inlineCode",{parentName:"p"},"install.sh"),", you can include the ",Object(r.b)("inlineCode",{parentName:"p"},"--help")," option."),Object(r.b)("blockquote",{parentName:"li"},Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Note:")),Object(r.b)("p",{parentName:"blockquote"},"If your local computer cannot pull images from ",Object(r.b)("inlineCode",{parentName:"p"},"docker.io")," or ",Object(r.b)("inlineCode",{parentName:"p"},"gcr.io"),", use the local gcr.io mirror and execute ",Object(r.b)("inlineCode",{parentName:"p"},"./install.sh --local kind --docker-mirror")," instead."))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Set the system environment variable:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"source ~/.bash_profile\n")))),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Note:")),Object(r.b)("ul",{parentName:"blockquote"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Depending on your network, these steps might take a few minutes.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"If you see an error message like this:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'ERROR: failed to create cluster: failed to generate kubeadm config content: failed to get kubernetes version from node: failed to get file: command "docker exec --privileged kind-control-plane cat /kind/version" failed with error: exit status 1\n')),Object(r.b)("p",{parentName:"li"},"  increase the available resources for Docker on your local computer and execute the following command:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"./install.sh --local kind --force-local-kube\n"))))),Object(r.b)("p",null,"When the process completes you will see a message indicating Chaos Mesh is successfully installed."),Object(r.b)("h3",{id:"deploy-the-application"},"Deploy the application"),Object(r.b)("p",null,"The next step is to deploy the application for testing. In our case here, we choose web-show because it allows us to directly observe the effect of network chaos. You can also deploy your own application for testing."),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Deploy web-show with the ",Object(r.b)("inlineCode",{parentName:"p"},"deploy.sh")," script:"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"# Make sure you are in the Chaos Mesh directory\ncd examples/web-show &&\n./deploy.sh\n")),Object(r.b)("blockquote",{parentName:"li"},Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Note:")),Object(r.b)("p",{parentName:"blockquote"},"If your local computer cannot pull images from ",Object(r.b)("inlineCode",{parentName:"p"},"docker.io"),", use the ",Object(r.b)("inlineCode",{parentName:"p"},"local gcr.io")," mirror and execute ",Object(r.b)("inlineCode",{parentName:"p"},"./deploy.sh --docker-mirror")," instead."))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Access the web-show application. From your web browser, go to ",Object(r.b)("inlineCode",{parentName:"p"},"http://localhost:8081"),"."))),Object(r.b)("h3",{id:"create-the-chaos-experiment"},"Create the chaos experiment"),Object(r.b)("p",null,"Now that everything is ready, it's time to run your chaos experiment!"),Object(r.b)("p",null,"Chaos Mesh uses ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/"}),"CustomResourceDefinitions")," (CRD) to define chaos experiments. CRD objects are designed separately based on different experiment scenarios, which greatly simplifies the definition of CRD objects. Currently, CRD objects that have been implemented in Chaos Mesh include PodChaos, NetworkChaos, IOChaos, TimeChaos, and KernelChaos. Later, we'll support more fault injection types."),Object(r.b)("p",null,"In this experiment, we are using ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/pingcap/chaos-mesh/blob/master/examples/web-show/network-delay.yaml"}),"NetworkChaos")," for the chaos experiment. The NetworkChaos configuration file, written in YAML, is shown below:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),'apiVersion: pingcap.com/v1alpha1\nkind: NetworkChaos\nmetadata:\n  name: network-delay-example\nspec:\n  action: delay\n  mode: one\n  selector:\n    namespaces:\n      - default\n    labelSelectors:\n      "app": "web-show"\n  delay:\n    latency: "10ms"\n    correlation: "100"\n    jitter: "0ms"\n  duration: "30s"\n  scheduler:\n    cron: "@every 60s"\n')),Object(r.b)("p",null,"For detailed descriptions of NetworkChaos actions, see ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/pingcap/chaos-mesh/wiki/Network-Chaos"}),"Chaos Mesh wiki"),". Here, we just rephrase the configuration as:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"target: ",Object(r.b)("inlineCode",{parentName:"li"},"web-show")),Object(r.b)("li",{parentName:"ul"},"mission: inject a ",Object(r.b)("inlineCode",{parentName:"li"},"10ms")," network delay every ",Object(r.b)("inlineCode",{parentName:"li"},"60s")),Object(r.b)("li",{parentName:"ul"},"attack duration: ",Object(r.b)("inlineCode",{parentName:"li"},"30s")," each time")),Object(r.b)("p",null,"To start NetworkChaos, do the following:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Run ",Object(r.b)("inlineCode",{parentName:"p"},"network-delay.yaml"),":"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"# Make sure you are in the chaos-mesh/examples/web-show directory\nkubectl apply -f network-delay.yaml\n"))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Access the web-show application. In your web browser, go to ",Object(r.b)("inlineCode",{parentName:"p"},"http://localhost:8081"),"."),Object(r.b)("p",{parentName:"li"},"From the line graph, you can tell that there is a 10 ms network delay every 60 seconds."))),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/using-chaos-mesh-to-insert-delays-in-web-show.png",alt:"Using Chaos Mesh to insert delays in web-show"}))),Object(r.b)("div",{class:"caption-center"}," Using Chaos Mesh to insert delays in web-show "),Object(r.b)("p",null,"Congratulations! You just stirred up a little bit of chaos. If you are intrigued and want to try out more chaos experiments with Chaos Mesh, check out ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/pingcap/chaos-mesh/tree/master/examples/web-show"}),"examples/web-show"),"."),Object(r.b)("h3",{id:"delete-the-chaos-experiment"},"Delete the chaos experiment"),Object(r.b)("p",null,"Once you're finished testing, terminate the chaos experiment."),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Delete ",Object(r.b)("inlineCode",{parentName:"p"},"network-delay.yaml"),":"),Object(r.b)("pre",{parentName:"li"},Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"# Make sure you are in the chaos-mesh/examples/web-show directory\nkubectl delete -f network-delay.yaml\n"))),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Access the web-show application. From your web browser, go to ",Object(r.b)("inlineCode",{parentName:"p"},"http://localhost:8081"),"."))),Object(r.b)("p",null,"From the line graph, you can see the network latency level is back to normal."),Object(r.b)("p",null,Object(r.b)("img",Object(a.a)({parentName:"p"},{src:"/img/network-latency-level-is-back-to-normal.png",alt:"Network latency level is back to normal"}))),Object(r.b)("div",{class:"caption-center"}," Network latency level is back to normal "),Object(r.b)("h3",{id:"delete-kubernetes-clusters"},"Delete Kubernetes clusters"),Object(r.b)("p",null,"After you're done with the chaos experiment, execute the following command to delete the Kubernetes clusters:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kind delete cluster --name=kind\n")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Note:")),Object(r.b)("p",{parentName:"blockquote"},"If you encounter the ",Object(r.b)("inlineCode",{parentName:"p"},"kind: command not found")," error, execute ",Object(r.b)("inlineCode",{parentName:"p"},"source ~/.bash_profile")," command first and then delete the Kubernetes clusters.")),Object(r.b)("h2",{id:"cool-whats-next"},"Cool! What's next?"),Object(r.b)("p",null,"Congratulations on your first successful journey into Chaos Engineering. How does it feel? Chaos Engineering is easy, right? But perhaps Chaos Mesh is not that easy-to-use. Command-line operation is inconvenient, writing YAML files manually is a bit tedious, or checking the experiment results is somewhat clumsy? Don't worry, Chaos Dashboard is on its way! Running chaos experiments on the web sure does sound exciting! If you'd like to help us build testing standards for cloud platforms or make Chaos Mesh better, we'd love to hear from you!"),Object(r.b)("p",null,"If you find a bug or think something is missing, feel free to file an issue, open a pull request (PR), or join us on the #sig-chaos-mesh channel in the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://pingcap.com/tidbslack"}),"TiDB Community")," slack workspace."),Object(r.b)("p",null,"GitHub: ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/pingcap/chaos-mesh"}),"https://github.com/pingcap/chaos-mesh")))}b.isMDXComponent=!0},150:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),b=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=b(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},u=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=b(n),u=a,m=p["".concat(i,".").concat(u)]||p[u]||h[u]||r;return n?o.a.createElement(m,s(s({ref:t},l),{},{components:n})):o.a.createElement(m,s({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);