"use strict";(self.webpackChunkchaos_mesh_website=self.webpackChunkchaos_mesh_website||[]).push([[6145],{3905:function(e,t,n){n.d(t,{Zo:function(){return l},kt:function(){return m}});var s=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,s,a=function(e,t){if(null==e)return{};var n,s,a={},r=Object.keys(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=s.createContext({}),u=function(e){var t=s.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},l=function(e){var t=u(e.components);return s.createElement(c.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},p=s.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=u(n),m=a,d=p["".concat(c,".").concat(m)]||p[m]||h[m]||r;return n?s.createElement(d,o(o({ref:t},l),{},{components:n})):s.createElement(d,o({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=p;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var u=2;u<r;u++)o[u]=n[u];return s.createElement.apply(null,o)}return s.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5144:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return i},metadata:function(){return c},assets:function(){return u},toc:function(){return l},default:function(){return p}});var s=n(22122),a=n(19756),r=(n(67294),n(3905)),o={slug:"/securing-tenant-namespaces-using-restrict-authorization-feature",title:"Securing tenant namespaces using restrict authorization feature in Chaos Mesh\xae",author:"Anurag Paliwal",author_title:"Contributor of Chaos Mesh",author_url:"https://github.com/anuragpaliwal80",author_image_url:"https://avatars.githubusercontent.com/u/3283882?v=4",image:"/img/chaos-engineering-tools-as-a-service.jpeg",tags:["Chaos Mesh","Chaos Engineering"]},i=void 0,c={permalink:"/blog/securing-tenant-namespaces-using-restrict-authorization-feature",editUrl:"https://github.com/chaos-mesh/website/edit/master/blog/2021-07-07-restrict-authorization.md",source:"@site/blog/2021-07-07-restrict-authorization.md",title:"Securing tenant namespaces using restrict authorization feature in Chaos Mesh\xae",description:"Chaos engineering tools",date:"2021-07-07T00:00:00.000Z",formattedDate:"July 7, 2021",tags:[{label:"Chaos Mesh",permalink:"/blog/tags/chaos-mesh"},{label:"Chaos Engineering",permalink:"/blog/tags/chaos-engineering"}],readingTime:2.795,truncated:!0,authors:[{name:"Anurag Paliwal",title:"Contributor of Chaos Mesh",url:"https://github.com/anuragpaliwal80",imageURL:"https://avatars.githubusercontent.com/u/3283882?v=4"}],prevItem:{title:"Chaos Mesh\xae Q&A",permalink:"/blog/chaos-mesh-q&a"},nextItem:{title:"How to efficiently stress test Pod memory",permalink:"/blog/how-to-efficiently-stress-test-pod-memory"}},u={authorsImageUrls:[void 0]},l=[{value:"Cluster multi-tenancy",id:"cluster-multi-tenancy",children:[]},{value:"Cluster having Chaos Mesh",id:"cluster-having-chaos-mesh",children:[]},{value:"For more tutorials",id:"for-more-tutorials",children:[]},{value:"Last but not least",id:"last-but-not-least",children:[]}],h={toc:l};function p(e){var t=e.components,o=(0,a.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,s.Z)({},h,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Chaos engineering tools",src:n(36986).Z})),(0,r.kt)("p",null,"A ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.google.com/kubernetes-engine/docs/concepts/multitenancy-overview"},"multi-tenant"),' cluster is shared by multiple users and/or workloads which are referred to as "tenants".The operators of multi-tenant clusters must isolate tenants from each other to minimize the damage that a compromised or malicious tenant can do to the cluster and other tenants.'),(0,r.kt)("h2",{id:"cluster-multi-tenancy"},"Cluster multi-tenancy"),(0,r.kt)("p",null,"When you plan a multi-tenant architecture, you should consider the layers of resource isolation in Kubernetes: cluster, namespace, node, Pod, and container."),(0,r.kt)("p",null,"Although Kubernetes cannot guarantee perfectly secure isolation between tenants, it does offer features that may be sufficient for specific use cases. You can separate each tenant and their Kubernetes resources into their own ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/"},"namespaces"),".\nKubernetes supports multiple virtual clusters backed by the same physical cluster. These virtual clusters are called namespaces. ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/"},"Namespaces")," are intended for use in environments with many users spread across multiple teams, or projects."),(0,r.kt)("h2",{id:"cluster-having-chaos-mesh"},"Cluster having Chaos Mesh"),(0,r.kt)("p",null,"You designed your Kubernetes cluster to have multiple tenant services. You followed the best security practices for Kubernetes: each tenant service is running in its own namespaces, users of these tenant services have appropriate access that also only for their respective namespaces, etc."),(0,r.kt)("p",null,"You enabled Chaos Mesh (",(0,r.kt)("a",{parentName:"p",href:"https://github.com/chaos-mesh/chaos-mesh"},"Chaos Mesh")," is a cloud-native Chaos Engineering platform that orchestrates chaos on Kubernetes environments) on the cluster so that your tenant services can perform different chaos activities to make sure their application/system is resilient. You have also given Chaos Mesh specific rights to those tenant service users so that they can manage Chaos Mesh resources using ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/rbac/"},"RBAC"),"."),(0,r.kt)("p",null,"Suppose one of the tenant users wants to perform pod kill operations in his/her namespace i.e. chaos-testing. To achieve the same, the user created the below Chaos Mesh YAML file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},"apiVersion: chaos-mesh.org/v1alpha1\nkind: PodChaos\nmetadata:\n  name: pod-kill\n  namespace: chaos-testing\nspec:\n  action: pod-kill\n  mode: one\n  selector:\n    namespaces:\n      - tidb-cluster-demo\n    labelSelectors:\n      'app.kubernetes.io/component': 'tikv'\n  scheduler:\n    cron: '@every 1m'\n")),(0,r.kt)("p",null,"The user has required rights to namespace chaos-testing, but does not have rights on tidb-cluster-demo namespace. When the user applies the above YAML file using kubectl, it will create the pod-kill Chaos Mesh resource in chaos-testing namespace. As we can see in the selector section, the user has specified some other namespace (tidb-cluster-demo), which means the pods which will be selected for this chaos operation will be from tidb-cluster-demo namespace, and not from the one for which the user has access i.e. chaos-testing. This means that this user is able to impact the other namespace for which (s)he does not have the rights. ",(0,r.kt)("strong",{parentName:"p"},"Problem!!!")),(0,r.kt)("p",null,"Since the release of Chaos Mesh 1.1.3, this security issue has been fixed with a restricted authorization feature. Now when user applies the above YAML file, the system shows the error similar to:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'Error when creating "pod/pod-kill.yaml": admission webhook "vauth.kb.io" denied the request: ... is forbidden on namespace\ntidb-cluster-demo\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Problem solved!")),(0,r.kt)("p",null,"Please note, if the user has required rights on tidb-cluster-demo namespace as well, then there will be no such error."),(0,r.kt)("h2",{id:"for-more-tutorials"},"For more tutorials"),(0,r.kt)("p",null,"In case you want to enforce that no user should be allowed to create chaos across namespaces, you can check out my previous blog: ",(0,r.kt)("a",{parentName:"p",href:"https://anuragpaliwal-93749.medium.com/securing-tenant-services-while-using-chaos-mesh-using-opa-3ae80c7f4b85"},"Securing tenant services while using chaos mesh using OPA"),"."),(0,r.kt)("h2",{id:"last-but-not-least"},"Last but not least"),(0,r.kt)("p",null,"If you are interested in Chaos Mesh and would like to learn more, you're welcome to join the ",(0,r.kt)("a",{parentName:"p",href:"https://slack.cncf.io/"},"Slack channel")," or submit your pull requests or issues to its ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/chaos-mesh/chaos-mesh"},"GitHub repository"),"."))}p.isMDXComponent=!0},36986:function(e,t,n){t.Z=n.p+"assets/images/chaos-mesh-restrict-authorization-83f3faf086be2029938cd1923256b5a2.jpeg"}}]);