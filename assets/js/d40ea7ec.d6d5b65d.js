"use strict";(self.webpackChunkchaos_mesh_website=self.webpackChunkchaos_mesh_website||[]).push([[9026],{99601:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"use-grafana-data-source","title":"Use Grafana Data Source Plugin for Observations","description":"This document describes how to install the Data Source plugin for Grafana and setup the plugin to observe Chaos Mesh events.","source":"@site/docs/use-grafana-data-source.md","sourceDirName":".","slug":"/use-grafana-data-source","permalink":"/docs/next/use-grafana-data-source","draft":false,"unlisted":false,"editUrl":"https://github.com/chaos-mesh/website/edit/master/docs/use-grafana-data-source.md","tags":[],"version":"current","frontMatter":{"title":"Use Grafana Data Source Plugin for Observations"},"sidebar":"docs","previous":{"title":"Integrate Chaos Mesh to GitHub Actions","permalink":"/docs/next/integrate-chaos-mesh-into-github-actions"},"next":{"title":"Chaosctl","permalink":"/docs/next/chaosctl-tool"}}');var a=s(86070),i=s(8637);const o={title:"Use Grafana Data Source Plugin for Observations"},l=void 0,r={},c=[{value:"Installation",id:"installation",level:2},{value:"With dashboard",id:"with-dashboard",level:3},{value:"With cli",id:"with-cli",level:3},{value:"Manual installation",id:"manual-installation",level:3},{value:"Setup",id:"setup",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Query",id:"query",level:2},{value:"Variables",id:"variables",level:2},{value:"Annotations",id:"annotations",level:2},{value:"Questions and feedback",id:"questions-and-feedback",level:2},{value:"What&#39;s next",id:"whats-next",level:2}];function h(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"This document describes how to install the Data Source plugin for Grafana and setup the plugin to observe Chaos Mesh events."}),"\n",(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsxs)(n.p,{children:["This plugin requires Chaos Mesh ",(0,a.jsx)(n.strong,{children:">=2.1"}),", Grafana >= ",(0,a.jsx)(n.strong,{children:"10.0"}),"."]}),(0,a.jsxs)(n.p,{children:["We only test the plugin on Grafana 10.0.3, it may support lower versions, but we are not sure. Upgrading to Grafana v10 is because of the ",(0,a.jsx)(n.a,{href:"https://github.com/chaos-mesh/datasource/issues/55",children:"Angular support deprecation"}),". If you encounter any problems, please open an issue to let us know."]})]}),"\n",(0,a.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,a.jsx)(n.h3,{id:"with-dashboard",children:"With dashboard"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://grafana.com/docs/grafana/latest/administration/plugin-management/#install-a-plugin",children:"https://grafana.com/docs/grafana/latest/administration/plugin-management/#install-a-plugin"})}),"\n",(0,a.jsx)(n.h3,{id:"with-cli",children:"With cli"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"grafana-cli plugins install chaosmeshorg-datasource\n"})}),"\n",(0,a.jsx)(n.h3,{id:"manual-installation",children:"Manual installation"}),"\n",(0,a.jsxs)(n.p,{children:["Download the plugin zip package with the following command or go to ",(0,a.jsx)(n.a,{href:"https://github.com/chaos-mesh/datasource/releases",children:"https://github.com/chaos-mesh/datasource/releases"})," to download:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"curl -LO https://github.com/chaos-mesh/datasource/releases/download/v3.0.0/chaosmeshorg-datasource-3.0.0.zip\n"})}),"\n",(0,a.jsx)(n.p,{children:"After downloading, unzip:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"unzip chaosmeshorg-datasource-3.0.0.zip -d YOUR_PLUGIN_DIR\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["To find the plugin directory, refer to ",(0,a.jsx)(n.a,{href:"https://grafana.com/docs/grafana/latest/plugins/installation/#install-a-packaged-plugin",children:"https://grafana.com/docs/grafana/latest/plugins/installation/#install-a-packaged-plugin"}),"."]})}),"\n",(0,a.jsxs)(n.p,{children:["Then update and save the ",(0,a.jsx)(n.code,{children:"grafana.ini"})," file:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ini",children:"[plugins]\n  allow_loading_unsigned_plugins = chaosmeshorg-datasource\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["To find the configuration file, refer to ",(0,a.jsx)(n.a,{href:"https://grafana.com/docs/grafana/latest/administration/configuration/#config-file-locations",children:"https://grafana.com/docs/grafana/latest/administration/configuration/#config-file-locations"}),"."]})}),"\n",(0,a.jsx)(n.p,{children:"Finally, restart Grafana to load the plugin."}),"\n",(0,a.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,a.jsxs)(n.p,{children:["Once installed, go to ",(0,a.jsx)(n.strong,{children:"Administration -> Data sources"})," and add Chaos Mesh, then go to the configuration page:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Settings",src:s(79185).A+"",width:"1500",height:"1700"})}),"\n",(0,a.jsxs)(n.p,{children:["Assuming you have Chaos Mesh installed locally, the Chaos Dashboard will export the API on port ",(0,a.jsx)(n.code,{children:"2333"})," by default. So, if you haven't changed anything, you can fill in ",(0,a.jsx)(n.code,{children:"http://localhost:2333"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Then use the ",(0,a.jsx)(n.code,{children:"port-forward"})," command to make the API externally accessible:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl port-forward -n chaos-mesh svc/chaos-dashboard 2333:2333\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Finally, click ",(0,a.jsx)(n.strong,{children:"Save & test"})," to test the connection. If it shows a successful notification, the setup is complete."]}),"\n",(0,a.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,a.jsxs)(n.p,{children:["If you deploy Chaos Mesh with ",(0,a.jsx)(n.a,{href:"/docs/next/manage-user-permissions",children:"permission authentication"}),", you need to add the ",(0,a.jsx)(n.code,{children:"Authorization"})," header to the configuration. You can follow the steps below to add the header:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Click the ",(0,a.jsx)(n.strong,{children:"Add header"})," button."]}),"\n",(0,a.jsxs)(n.li,{children:["Fill in the ",(0,a.jsx)(n.code,{children:"Authorization"})," in the ",(0,a.jsx)(n.strong,{children:"Header"})," field."]}),"\n",(0,a.jsxs)(n.li,{children:["Follow ",(0,a.jsx)(n.a,{href:"/docs/next/manage-user-permissions#get-the-token",children:"this section"})," to get the token."]}),"\n",(0,a.jsxs)(n.li,{children:["Fill in the ",(0,a.jsx)(n.code,{children:"Bearer YOUR_TOKEN"})," in the ",(0,a.jsx)(n.strong,{children:"Value"})," field."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Then don't forget to click ",(0,a.jsx)(n.strong,{children:"Save & test"})," to test the connection."]}),"\n",(0,a.jsx)(n.h2,{id:"query",children:"Query"}),"\n",(0,a.jsx)(n.p,{children:"The data source plugin looks at the Chaos Mesh through the lens of events, and the following options are responsible for filtering the different events:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Object ID"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Filter by object uuid."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Namespace"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Filter by different namespace."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Name"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Filter by object name."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Kind"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Filter by kind (PodChaos, NetworkChaos, Schedule...). You can also input an arbitrary kind if you implement a new kind in Chaos Mesh."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Limit"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Limit the number of events."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["All of them will be passed as parameters to the ",(0,a.jsx)(n.code,{children:"/api/events"})," API."]}),"\n",(0,a.jsx)(n.h2,{id:"variables",children:"Variables"}),"\n",(0,a.jsx)(n.p,{children:"The data source plugin supports adding query variables by different metrics:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Variables",src:s(86199).A+"",width:"1400",height:"1540"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Namespace"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["After selection, all available namespaces will show in the ",(0,a.jsx)(n.strong,{children:"Preview of values"})," directly."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Kind"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["Same as ",(0,a.jsx)(n.strong,{children:"Namespace"}),". Retrieve all kinds."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Experiment/Schedule/Workflow"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["Same as ",(0,a.jsx)(n.strong,{children:"Namespace"}),". Retrieve current all experiments/schedules/workflows."]}),"\n",(0,a.jsxs)(n.p,{children:["You can also specify the ",(0,a.jsx)(n.code,{children:"queries"})," to further filter the values, for example, ",(0,a.jsx)(n.code,{children:"?namespace=default"})," will only retrieve the experiments/schedules/workflows in the ",(0,a.jsx)(n.code,{children:"default"})," namespace."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"annotations",children:"Annotations"}),"\n",(0,a.jsx)(n.p,{children:"You can integrate events into panels via annotations, the following is a sample creation, it will retrieve all PodChaos events:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Annotations",src:s(56314).A+"",width:"2628",height:"2000"})}),"\n",(0,a.jsxs)(n.p,{children:["Please refer to ",(0,a.jsx)(n.a,{href:"#query",children:"Query"})," to fill in the corresponding fields."]}),"\n",(0,a.jsx)(n.h2,{id:"questions-and-feedback",children:"Questions and feedback"}),"\n",(0,a.jsxs)(n.p,{children:["If you encounter problems during installation or setup, you are welcome to ask questions to the community at ",(0,a.jsx)(n.a,{href:"https://cloud-native.slack.com/archives/C0193VAV272",children:"CNCF Slack"}),", or create an ",(0,a.jsx)(n.a,{href:"https://github.com/chaos-mesh/datasource/issues",children:"GitHub issue"})," to communicate with the Chaos Mesh team."]}),"\n",(0,a.jsx)(n.h2,{id:"whats-next",children:"What's next"}),"\n",(0,a.jsxs)(n.p,{children:["If you want to learn more details about the Data Source plugin, feel free to check out the source code at ",(0,a.jsx)(n.a,{href:"https://github.com/chaos-mesh/datasource",children:"chaos-mesh/datasource"}),"."]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},56314:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/annotations-86a3349a09325e27242b1fc1f21b1a45.png"},79185:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/settings-85481cae855e1d6764fb71a396fc037d.png"},86199:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/variables-eb628e7bff9c829d22fb57ec9961e7ba.png"},8637:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var t=s(30758);const a={},i=t.createContext(a);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);