<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-90760217-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Chaos Mesh®" href="/opensearch.xml"><title data-react-helmet="true">Simulating Clock Skew in K8s Without Affecting Other Containers on the Node | Chaos Mesh®</title><meta data-react-helmet="true" property="og:title" content="Simulating Clock Skew in K8s Without Affecting Other Containers on the Node | Chaos Mesh®"><meta data-react-helmet="true" name="description" content="!Clock synchronization in distributed system"><meta data-react-helmet="true" property="og:description" content="!Clock synchronization in distributed system"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/styles.d350a560.css">
<link rel="preload" href="/styles.d57b0848.js" as="script">
<link rel="preload" href="/runtime~main.4dc1ab68.js" as="script">
<link rel="preload" href="/main.02415e59.js" as="script">
<link rel="preload" href="/1.3f51d903.js" as="script">
<link rel="preload" href="/2.37c97586.js" as="script">
<link rel="preload" href="/3.4250f123.js" as="script">
<link rel="preload" href="/ccc49370.caf0cf65.js" as="script">
<link rel="preload" href="/6897adcd.5fabca82.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Chaos Mesh Logo"></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Chaos Mesh Logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><article><header><h1 class="margin-bottom--sm blogPostTitle_2RZH">Simulating Clock Skew in K8s Without Affecting Other Containers on the Node</h1><div class="margin-vert--md"><time datetime="2020-04-20T00:00:00.000Z" class="blogPostDate_3tRe">April 20, 2020  · 9 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/cwen0" target="_blank" rel="noreferrer noopener"><img src="https://avatars1.githubusercontent.com/u/22956341?v=4" alt="Cwen Yin"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/cwen0" target="_blank" rel="noreferrer noopener">Cwen Yin</a></h4><small class="avatar__subtitle">Maintainer of Chaos Mesh</small></div></div></header><section class="markdown"><p><img src="/img/clock-sync-chaos-engineering-k8s.jpg" alt="Clock synchronization in distributed system"></p><p><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer">Chaos Mesh™</a>, an easy-to-use, open-source, cloud-native chaos engineering platform for Kubernetes (K8s), has a new feature, TimeChaos, which simulates the <a href="https://en.wikipedia.org/wiki/Clock_skew#On_a_network" target="_blank" rel="noopener noreferrer">clock skew</a> phenomenon. Usually, when we modify clocks in a container, we want a <a href="https://learning.oreilly.com/library/view/chaos-engineering/9781491988459/ch07.html">minimized blast radius</a>, and we don&#x27;t want the change to affect the other containers on the node. In reality, however, implementing this can be harder than you think. How does Chaos Mesh solve this problem?</p><p>In this post, I&#x27;ll describe how we hacked through different approaches of clock skew and how TimeChaos in Chaos Mesh enables time to swing freely in containers.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="simulating-clock-skew-without-affecting-other-containers-on-the-node"></a>Simulating clock skew without affecting other containers on the node<a aria-hidden="true" tabindex="-1" class="hash-link" href="#simulating-clock-skew-without-affecting-other-containers-on-the-node" title="Direct link to heading">#</a></h2><p>Clock skew refers to the time difference between clocks on nodes within a network. It might cause reliability problems in a distributed system, and it&#x27;s a concern for designers and developers of complex distributed systems. For example, in a distributed SQL database, it&#x27;s vital to maintain a synchronized local clock across nodes to achieve a consistent global snapshot and ensure the ACID properties for transactions.</p><p>Currently, there are well-recognized <a href="https://pingcap.com/blog/Time-in-Distributed-Systems/" target="_blank" rel="noopener noreferrer">solutions to synchronize clocks</a>, but without proper testing, you can never be sure that your implementation is solid.</p><p>Then how can we test global snapshot consistency in a distributed system? The answer is obvious: we can simulate clock skew to test whether distributed systems can keep a consistent global snapshot under abnormal clock conditions. Some testing tools support simulating clock skew in containers, but they have an impact on physical nodes.</p><p><a href="https://github.com/chaos-mesh/chaos-mesh/wiki/Time-Chaos" target="_blank" rel="noopener noreferrer">TimeChaos</a> is a tool that <strong>simulates clock skew in containers to test how it impacts your application without affecting the whole node</strong>. This way, we can precisely identify the potential consequences of clock skew and take measures accordingly.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="various-approaches-for-simulating-clock-skew-weve-explored"></a>Various approaches for simulating clock skew we&#x27;ve explored<a aria-hidden="true" tabindex="-1" class="hash-link" href="#various-approaches-for-simulating-clock-skew-weve-explored" title="Direct link to heading">#</a></h2><p>Reviewing the existing choices, we know clearly that they cannot be applied to Chaos Mesh, which runs on Kubernetes. Two common ways of simulating clock skew--changing the node clock directly and using the Jepsen framework--change the time for all processes on the node. These are not acceptable solutions for us. In a Kubernetes container, if we inject a clock skew error that affects the entire node, other containers on the same node will be disturbed. Such a clumsy approach is not tolerable.</p><p>Then how are we supposed to tackle this problem? Well, the first thing that comes into our mind is finding solutions in the kernel using <a href="https://en.wikipedia.org/wiki/Berkeley_Packet_Filter" target="_blank" rel="noopener noreferrer">Berkeley Packet Filter</a> (BPF).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="ld_preload"></a><code>LD_PRELOAD</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#ld_preload" title="Direct link to heading">#</a></h3><p><code>LD_PRELOAD</code> is a Linux environment variable that lets you define which dynamic link library is loaded before the program execution.</p><p>This variable has two advantages:</p><ul><li>We can call our own functions without being aware of the source code.</li><li>We can inject code into other programs to achieve specific purposes.</li></ul><p>For some languages that use applications to call the time function in glibc, such as Rust and C, using <code>LD_PRELOAD</code> is enough to simulate clock skew. But things are trickier for Golang. Because languages such as Golang directly parse virtual Dynamic Shared Object (<a href="http://man7.org/linux/man-pages/man7/vdso.7.html">vDSO</a>), a mechanism to speed up system calls. To obtain the time function address, we can&#x27;t simply use <code>LD_PRELOAD</code> to intercept the glic interface. Therefore, <code>LD_PRELOAD</code> is not our solution.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="use-bpf-to-modify-the-return-value-of-clock_gettime-system-call"></a>Use BPF to modify the return value of <code>clock_gettime</code> system call<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-bpf-to-modify-the-return-value-of-clock_gettime-system-call" title="Direct link to heading">#</a></h3><p>We also tried to filter the task <a href="http://www.linfo.org/pid.html">process identification number</a> (PID) with BPF. This way, we could simulate clock skew on a specified process and modify the return value of the <code>clock_gettime</code> system call.</p><p>This seemed like a good idea, but we also encountered a problem: in most cases, vDSO speeds up <code>clock_gettime</code>, but <code>clock_gettime</code> doesn&#x27;t make a system call. This selection didn&#x27;t work, either. Oops.</p><p>Thankfully, we determined that if the system kernel version is 4.18 or later, and if we use the <a href="https://www.kernel.org/doc/html/latest/timers/hpet.html">HPET</a> clock, <code>clock_gettime()</code> gets time by making normal system calls instead of vDSO. We implemented <a href="https://github.com/chaos-mesh/bpfki" target="_blank" rel="noopener noreferrer">a version of clock skew</a> using this approach, and it works fine for Rust and C. As for Golang, the program can get the time right, but if we perform <code>sleep</code> during the clock skew injection, the sleep operation is very likely to be blocked. Even after the injection is canceled, the system cannot recover. Thus, we have to give up this approach, too.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="timechaos-our-final-hack"></a>TimeChaos, our final hack<a aria-hidden="true" tabindex="-1" class="hash-link" href="#timechaos-our-final-hack" title="Direct link to heading">#</a></h2><p>From the previous section, we know that programs usually get the system time by calling <code>clock_gettime</code>. In our case, <code>clock_gettime</code> uses vDSO to speed up the calling process, so we cannot use <code>LD_PRELOAD</code> to hack the <code>clock_gettime</code> system calls.</p><p>We figured out the cause; then what&#x27;s the solution? Start from vDSO. If we can redirect the address that stores the <code>clock_gettime</code> return value in vDSO to an address we define, we can solve the problem.</p><p>Easier said than done. To achieve this goal, we must tackle the following problems:</p><ul><li>Know the user-mode address used by vDSO</li><li>Know vDSO&#x27;s kernel-mode address, if we want to modify the <code>clock_gettime</code> function in vDSO by any address in the kernel mode</li><li>Know how to modify vDSO data</li></ul><p>First, we need to peek inside vDSO. We can see the vDSO memory address in <code>/proc/pid/maps</code>.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cat /proc/pid/maps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">7ffe53143000-7ffe53145000 r-xp 00000000 00:00 0                     [vdso]</span></div></div></div></div></div><p>The last line is vDSO information. The privilege of this memory space is <code>r-xp</code>: readable and executable, but not writable. That means the user mode cannot modify this memory. We can use <a href="http://man7.org/linux/man-pages/man2/ptrace.2.html">ptrace</a> to avoid this restriction.</p><p>Next, we use <code>gdb dump memory</code> to export the vDSO and use <code>objdump</code> to see what&#x27;s inside. Here is what we get:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(gdb) dump memory vdso.so 0x00007ffe53143000 0x00007ffe53145000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ objdump -T vdso.so</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">vdso.so:    file format elf64-x86-64</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DYNAMIC SYMBOL TABLE:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ffffffffff700600  w  DF .text   0000000000000545  LINUX_2.6  clock_gettime</span></div></div></div></div></div><p>We can see that the whole vDSO is like a <code>.so</code> file, so we can use an executable and linkable format (ELF) file to format it. With this information, a basic workflow for implementing TimeChaos starts to take shape:</p><p><img src="/img/timechaos-workflow.jpg" alt="TimeChaos workflow"></p><div class="caption-center"> TimeChaos workflow </div><p>The chart above is the process of <strong>TimeChaos</strong>, an implementation of clock skew in Chaos Mesh.</p><ol><li>Use ptrace to attach the specified PID process to stop the current process.</li><li>Use ptrace to create a new mapping in the virtual address space of the calling process and use <a href="https://linux.die.net/man/2/process_vm_writev" target="_blank" rel="noopener noreferrer"><code>process_vm_writev</code></a> to write the <code>fake_clock_gettime</code> function we defined into the memory space.</li><li>Use <code>process_vm_writev</code> to write the specified parameters into <code>fake_clock_gettime</code>. These parameters are the time we would like to inject, such as two hours backward or two days forward.</li><li>Use ptrace to modify the <code>clock_gettime</code> function in vDSO and redirect to the <code>fake_clock_gettime</code> function.</li><li>Use ptrace to detach the PID process.</li></ol><p>If you are interested in the details, see the <a href="https://github.com/chaos-mesh/chaos-mesh/blob/master/pkg/time/time_linux.go">Chaos Mesh GitHub repository</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="simulating-clock-skew-on-a-distributed-sql-database"></a>Simulating clock skew on a distributed SQL database<a aria-hidden="true" tabindex="-1" class="hash-link" href="#simulating-clock-skew-on-a-distributed-sql-database" title="Direct link to heading">#</a></h2><p>Statistics speak volumes. Here we&#x27;re going to try TimeChaos on <a href="https://pingcap.com/docs/stable/overview/" target="_blank" rel="noopener noreferrer">TiDB</a>, an open source, <a href="https://en.wikipedia.org/wiki/NewSQL" target="_blank" rel="noopener noreferrer">NewSQL</a>, distributed SQL database that supports <a href="https://en.wikipedia.org/wiki/Hybrid_transactional/analytical_processing" target="_blank" rel="noopener noreferrer">Hybrid Transactional/Analytical Processing</a> (HTAP) workloads, to see if the chaos testing can really work.</p><p>TiDB uses a centralized service Timestamp Oracle (TSO) to obtain the globally consistent version number, and to ensure that the transaction version number increases monotonically. The TSO service is managed by the Placement Driver (PD) component. Therefore, we choose a random PD node and inject TimeChaos regularly, each with a 10-millisecond-backward clock skew. Let&#x27;s see if TiDB can meet the challenge.</p><p>To better perform the testing, we use <a href="https://github.com/cwen0/bank" target="_blank" rel="noopener noreferrer">bank</a> as the workload, which simulates the financial transfers in a banking system. It&#x27;s often used to verify the correctness of database transactions.</p><p>This is our test configuration:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: chaos-mesh.org/v1alpha1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kind: TimeChaos</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: time-skew-example</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  namespace: tidb-demo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  mode: one</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    labelSelectors:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;app.kubernetes.io/component&quot;: &quot;pd&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  timeOffset:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    sec: -600</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  clockIds:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - CLOCK_REALTIME</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  duration: &quot;10s&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  scheduler:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cron: &quot;@every 1m&quot;</span></div></div></div></div></div><p>During this test, Chaos Mesh injects TimeChaos into a chosen PD Pod every 1 millisecond for 10 seconds. Within the duration, the time acquired by PD will have a 600 second offset from the actual time. For further details, see <a href="https://github.com/chaos-mesh/chaos-mesh/wiki/Time-Chaos" target="_blank" rel="noopener noreferrer">Chaos Mesh Wiki</a>.</p><p>Let&#x27;s create a TimeChaos experiment using the <code>kubectl apply</code> command:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f pd-time.yaml</span></div></div></div></div></div><p>Now, we can retrieve the PD log by the following command:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl logs -n tidb-demo tidb-app-pd-0 | grep &quot;system time jump backward&quot;</span></div></div></div></div></div><p>Here&#x27;s the log:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:06:23.164 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585041383060109693]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:16:32.260 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585041992160476622]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:20:32.059 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585042231960027622]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:23:32.059 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585042411960079655]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:25:32.059 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585042531963640321]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:28:32.060 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585042711960148191]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:33:32.063 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585043011960517655]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:34:32.060 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585043071959942937]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:35:32.059 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585043131978582964]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:36:32.059 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585043191960687755]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:38:32.060 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585043311959970737]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:41:32.060 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585043491959970502]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2020/03/24 09:45:32.061 +00:00] [ERROR] [systime_mon.go:32] [&quot;system time jump backward&quot;] [last=1585043731961304629]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div></div></div></div></div><p>From the log above, we see that every now and then, PD detects that the system time rolls back. This means:</p><ul><li>TimeChaos successfully simulates clock skew.</li><li>PD can deal with the clock skew situation.</li></ul><p>That&#x27;s encouraging. But does TimeChaos affect services other than PD? We can check it out in the Chaos Dashboard:</p><p><img src="/img/chaos-dashboard.jpg" alt="Chaos Dashboard"></p><div class="caption-center"> Chaos Dashboard </div><p>It&#x27;s clear that in the monitor, TimeChaos was injected every 1 millisecond and the whole duration lasted 10 seconds. What&#x27;s more, TiDB was not affected by that injection. The bank program ran normally, and performance was not affected.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="try-out-chaos-mesh"></a>Try out Chaos Mesh<a aria-hidden="true" tabindex="-1" class="hash-link" href="#try-out-chaos-mesh" title="Direct link to heading">#</a></h2><p>As a cloud-native chaos engineering platform, Chaos Mesh features all-around <a href="https://pingcap.com/blog/chaos-mesh-your-chaos-engineering-solution-for-system-resiliency-on-kubernetes/" target="_blank" rel="noopener noreferrer">fault injection methods for complex systems on Kubernetes</a>, covering faults in Pods, the network, the file system, and even the kernel.</p><p>Wanna have some hands-on experience in chaos engineering? Welcome to <a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer">Chaos Mesh</a>. This <a href="https://pingcap.com/blog/run-first-chaos-experiment-in-ten-minutes/" target="_blank" rel="noopener noreferrer">10-minute tutorial</a> will help you quickly get started with chaos engineering and run your first chaos experiment with Chaos Mesh.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/chaos-mesh">Chaos Mesh</a><a class="margin-horiz--sm" href="/blog/tags/chaos-engineering">Chaos Engineering</a><a class="margin-horiz--sm" href="/blog/tags/kubernetes">Kubernetes</a><a class="margin-horiz--sm" href="/blog/tags/distributed-system">Distributed system</a></div></footer></article><div><a href="https://github.com/chaos-mesh/chaos-mesh/edit/master/website/blog/blog/2020-04-20-simulating-clock-skew-in-k8s-without-affecting-other-containers-on-node.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/run_your_first_chaos_experiment"><div class="pagination-nav__sublabel">Next Post</div><div class="pagination-nav__label">Run Your First Chaos Experiment in 10 Minutes »</div></a></div></nav></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/installation/installation">Getting started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/user_guides/run_chaos_experiment">User Guide</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/chaos_mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://chaos-mesh.org/tidbslack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/chaos-mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 PingCAP, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.d57b0848.js"></script>
<script src="/runtime~main.4dc1ab68.js"></script>
<script src="/main.02415e59.js"></script>
<script src="/1.3f51d903.js"></script>
<script src="/2.37c97586.js"></script>
<script src="/3.4250f123.js"></script>
<script src="/ccc49370.caf0cf65.js"></script>
<script src="/6897adcd.5fabca82.js"></script>
</body>
</html>