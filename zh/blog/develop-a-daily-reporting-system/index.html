<!doctype html>
<html lang="zh" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">How to Develop a Daily Reporting System to Track Chaos Testing Results | Chaos Mesh</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://chaos-mesh.org/zh/blog/develop-a-daily-reporting-system/"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="How to Develop a Daily Reporting System to Track Chaos Testing Results | Chaos Mesh"><meta data-rh="true" name="description" content="How to Develop a Daily Reporting System to Track Chaos Testing Results"><meta data-rh="true" property="og:description" content="How to Develop a Daily Reporting System to Track Chaos Testing Results"><meta data-rh="true" property="og:image" content="https://chaos-mesh.org/zh/img/blog/chaos-mesh-digitalchina-banner.png"><meta data-rh="true" name="twitter:image" content="https://chaos-mesh.org/zh/img/blog/chaos-mesh-digitalchina-banner.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-01-11T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/lileiaab"><meta data-rh="true" property="article:tag" content="Chaos Mesh,Chaos Engineering,Use case"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://chaos-mesh.org/zh/blog/develop-a-daily-reporting-system/"><link data-rh="true" rel="alternate" href="https://chaos-mesh.org/blog/develop-a-daily-reporting-system/" hreflang="en"><link data-rh="true" rel="alternate" href="https://chaos-mesh.org/zh/blog/develop-a-daily-reporting-system/" hreflang="zh"><link data-rh="true" rel="alternate" href="https://chaos-mesh.org/blog/develop-a-daily-reporting-system/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3BY0S3HQX6-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Chaos Mesh RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Chaos Mesh Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-90760217-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<link rel="search" type="application/opensearchdescription+xml" title="Chaos Mesh" href="/zh/opensearch.xml"><link rel="stylesheet" href="/zh/assets/css/styles.7ff201cf.css">
<link rel="preload" href="/zh/assets/js/runtime~main.516a5d87.js" as="script">
<link rel="preload" href="/zh/assets/js/main.3528f3fc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_urkK" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_gKCh"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/logos/logo-mini.svg" alt="Chaos Mesh" class="themedImage_dqhE themedImage--light_pG96"><img src="/zh/img/logos/logo-mini-white.svg" alt="Chaos Mesh" class="themedImage_dqhE themedImage--dark_RvBr"></div><b class="navbar__title text--truncate">Chaos Mesh</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/docs/">2.6.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/">Next</a></li><li><a class="dropdown__link" href="/zh/docs/">2.6.1</a></li><li><a class="dropdown__link" href="/zh/docs/2.5.2/">2.5.2</a></li><li><a class="dropdown__link" href="/zh/docs/2.4.3/">2.4.3</a></li><li><hr style="margin: .5em 0;"></li><li><a class="dropdown__link" href="/zh/versions/">All Versions</a></li><li><a class="dropdown__link" href="/zh/supported-releases/">Supported Releases</a></li></ul></div><a class="navbar__item navbar__link" href="/zh/docs/">文档</a><a href="https://community.cncf.io/chaos-mesh-community/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">活动<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_OmM5"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/blog/">博客</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_RVbG"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/blog/develop-a-daily-reporting-system/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/blog/develop-a-daily-reporting-system/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub"></a><div class="toggle_CBoD colorModeToggle_U4Ms"><button class="clean-btn toggleButton_Qywp toggleButtonDisabled_sUWV" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_uNXX"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_NcA8"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_oPT5"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_vGGt"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_KXxU thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_ycaT margin-bottom--md">最近的文章</div><ul class="sidebarItemList_uYfz clean-list"><li class="sidebarItem_cAtR"><a class="sidebarItemLink_rhtS" href="/zh/blog/chaos-mesh-qa-at-kubecon-eu-2022/">Chaos Mesh Q&amp;A at KUBECON EU 2022</a></li><li class="sidebarItem_cAtR"><a class="sidebarItemLink_rhtS" href="/zh/blog/experience-as-a-chaos-mesh-lfx-mentee/">Experience as an LFX Mentee for Chaos Mesh</a></li><li class="sidebarItem_cAtR"><a aria-current="page" class="sidebarItemLink_rhtS sidebarItemLinkActive_HJVM" href="/zh/blog/develop-a-daily-reporting-system/">How to Develop a Daily Reporting System to Track Chaos Testing Results</a></li><li class="sidebarItem_cAtR"><a class="sidebarItemLink_rhtS" href="/zh/blog/share-your-chaos-mesh-story/">Share your #ChaosMeshStory!</a></li><li class="sidebarItem_cAtR"><a class="sidebarItemLink_rhtS" href="/zh/blog/deploy-chaos-mesh-on-kubesphere/">Deploy Chaos Mesh on KubeSphere</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://chaos-mesh.org/zh/img/blog/chaos-mesh-digitalchina-banner.png"><header><h1 class="title_xn6M" itemprop="headline">How to Develop a Daily Reporting System to Track Chaos Testing Results</h1><div class="container_dXYV margin-vert--md"><time datetime="2022-01-11T00:00:00.000Z" itemprop="datePublished">2022年1月11日</time> · <!-- -->7 分钟阅读</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_jqgM"><div class="avatar margin-bottom--sm"><a href="https://github.com/lileiaab" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/88825087?v=4" alt="Lei Li"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/lileiaab" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Lei Li</span></a></div><small class="avatar__subtitle" itemprop="description">Senior software engineer at Digital China</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="How to Develop a Daily Reporting System to Track Chaos Testing Results" src="/zh/assets/images/chaos-mesh-digitalchina-banner-c7d6ac176f56621aa799af0e30d06e96.png" width="1501" height="501" class="img_t5GP"></p><p>Chaos Mesh is a cloud-native chaos engineering platform that orchestrates chaos experiments on Kubernetes environments. It allows you to test the resilience of your system by simulating problems such as network faults, file system faults, and Pod faults. After each chaos experiment, you can review the testing results by checking the logs. But this is neither direct nor efficient. Therefore, I decided to develop a daily reporting system that would automatically analyze logs and generate reports. This way, it’s easy to examine the logs and identify the issues.</p><p>In this article, I will give you some insights about how to build a daily reporting system, as well as the problems I encountered during the process and how I fixed them.</p><h2 class="anchor anchorWithHideOnScrollNavbar_dOSS" id="deploy-chaos-mesh-on-kubernetes">Deploy Chaos Mesh on Kubernetes<a href="#deploy-chaos-mesh-on-kubernetes" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>Chaos Mesh is designed for Kubernetes, which is one of the important reasons why it can allow users to inject faults into the file system, Pod, or network for specific applications.</p><p>In earlier documents, Chaos Mesh offered two ways to quickly deploy a virtual Kubernetes cluster on your machine: <a href="https://github.com/kubernetes-sigs/kind" target="_blank" rel="noopener noreferrer">kind</a> and <a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener noreferrer">minikube</a>. Generally, it only takes a one-line command to deploy a Kubernetes cluster as well as install Chaos Mesh. But there are some problems:</p><ul><li>Starting Kubernetes clusters locally affects network-related fault types.</li><li>Users on the Chinese mainland might experience an extremely slow process to pull the Docker image or even a timeout.</li></ul><p>If you use the provided script to deploy a Kubernetes cluster using kind, all Kubernetes nodes are virtual machines (VM). This adds difficulty when you pull the image offline. To address this issue, you can deploy the Kubernetes cluster on multiple physical machines instead, with each physical machine acting as a worker node. To expedite the image pulling process, you can use the <code>docker load</code> command to load the required image in advance. Apart from the two problems above, you can install <a href="https://kubernetes.io/docs/reference/kubectl/overview/" target="_blank" rel="noopener noreferrer">kubectl</a> and <a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a> by following the documentation.</p><p>Note: For the latest installation and deployment instructions, refer to <a href="https://chaos-mesh.org/docs/quick-start/" target="_blank" rel="noopener noreferrer">Chaos Mesh Quick Start</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_dOSS" id="deploy-tidb">Deploy TiDB<a href="#deploy-tidb" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>The next step is to deploy TiDB on Kubernetes. I used TiDB Operator to streamline the process. For details, check out <a href="https://docs.pingcap.com/tidb-in-kubernetes/stable/get-started" target="_blank" rel="noopener noreferrer">Get started with TiDB Operator in Kubernetes</a>.</p><p>I’d like to highlight two points in this process:</p><ul><li>First, install Custom Resource Definitions (CRDs) to implement different components of TiDB Operator. Otherwise, you’ll get errors when you try to install TiDB Operator.</li><li>Use <a href="https://longhorn.io/" target="_blank" rel="noopener noreferrer">Longhorn</a>, a distributed block storage system for Kubernetes, to create local persistent volumes (PV) for your Kubernetes cluster. This way, you don’t have to create PVs in advance: whenever a Pod is pulled, a PV is automatically created and mounted.</li></ul><p>The biggest problem that I encountered was that pulling the image could be extremely slow when deploying the service. If the nodes in your Kubernetes cluster are virtual machines, pull the required images in advance and load them to the Docker of each machine:</p><div class="language-bash codeBlockContainer_uizA theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_uij_"><pre tabindex="0" class="prism-code language-bash codeBlock_fGaF thin-scrollbar"><code class="codeBlockLines_JmuN"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">## Pull required images on a machine with a good network connection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> pull pingcap/tikv:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> pull pingcap/tidb:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> pull pingcap/pd:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">## Export images and save them to each machine in the Kubernetes cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> save -o tikv.tar pingcap/tikv:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> save -o tidb.tar pingcap/tidb:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> save -o pd.tar pingcap/pd:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">## Load images to each machine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> load </span><span class="token operator">&amp;</span><span class="token plain">lt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> tikv.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> load </span><span class="token operator">&amp;</span><span class="token plain">lt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> tidb.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker</span><span class="token plain"> load </span><span class="token operator">&amp;</span><span class="token plain">lt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> pd.tar</span><br></span></code></pre><div class="buttonGroup_D7ol"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_isze" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_WOVI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Vt_x"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above commands allow you to use the TiDB image in the local Docker registry to deploy the latest TiDB cluster, saving you the trouble of pulling the image from the remote repository. The idea also applies to the Chaos Mesh installation as described earlier. If you do not know which images you need to pull, install Chaos Mesh using Helm to trigger the installation process, then use the <code>kubectl describe</code> command to verify:</p><div class="language-bash codeBlockContainer_uizA theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_uij_"><pre tabindex="0" class="prism-code language-bash codeBlock_fGaF thin-scrollbar"><code class="codeBlockLines_JmuN"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">## Check pods that are deployed in a specific namespace.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl describe pods -n tidb-test</span><br></span></code></pre><div class="buttonGroup_D7ol"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_isze" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_WOVI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Vt_x"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The mirror pulling process usually takes the longest time to complete. If the Pod is being scheduled to a node, check it later.</p><h2 class="anchor anchorWithHideOnScrollNavbar_dOSS" id="run-a-chaos-experiment">Run a chaos experiment<a href="#run-a-chaos-experiment" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>To run a chaos experiment, you have to define it first through YAML files and use <code>kubectl apply</code> to start it. In this example, I created a chaos experiment using PodChaos to simulate a Pod crashing. For detailed instructions, refer to <a href="https://chaos-mesh.org/docs/run-a-chaos-experiment/" target="_blank" rel="noopener noreferrer">Run a Chaos Experiment</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_dOSS" id="generate-daily-report">Generate daily report<a href="#generate-daily-report" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_dOSS" id="collect-logs">Collect logs<a href="#collect-logs" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>Usually, when you run chaos experiments on TiDB clusters, many errors are returned. To collect those error logs, run the <code>kubectl logs</code> command:</p><div class="language-bash codeBlockContainer_uizA theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_uij_"><pre tabindex="0" class="prism-code language-bash codeBlock_fGaF thin-scrollbar"><code class="codeBlockLines_JmuN"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl logs </span><span class="token operator">&amp;</span><span class="token plain">lt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">podname</span><span class="token operator">&gt;</span><span class="token plain"> -n tidb-test --since</span><span class="token operator">=</span><span class="token plain">24h </span><span class="token operator">&gt;&gt;</span><span class="token plain"> tidb.log</span><br></span></code></pre><div class="buttonGroup_D7ol"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_isze" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_WOVI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Vt_x"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All logs generated in the past 24 hours of the specific Pod in the <code>tidb-test</code> namespace will be saved to the <code>tidb.log</code> file.</p><h3 class="anchor anchorWithHideOnScrollNavbar_dOSS" id="filter-errors-and-warnings">Filter errors and warnings<a href="#filter-errors-and-warnings" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>In this step, you have to filter error messages and warning messages from logs. There are two options:</p><ul><li>Use text processing tools, such as awk. This requires a proficient understanding of Linux/Unix commands.</li><li>Write a script. If you’re not familiar with Linux/Unix commands, this is the better option.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_dOSS" id="draw-a-plot">Draw a plot<a href="#draw-a-plot" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>For plotting, I used <a href="http://www.gnuplot.info/" target="_blank" rel="noopener noreferrer">gnuplot</a>, a Linux command-line graphing utility. In the example below, I imported the pressure measurement results and created a line graph to show how queries per second (QPS) were affected when a specific Pod became unavailable. Since the chaos experiment was executed periodically, the number of QPS exhibited a pattern: it would drop abruptly and then quickly return to normal.</p><p><img loading="lazy" alt="QPS line graph" src="/zh/assets/images/qps-line-graph-10389785bbe639db08850f5d73c47239.png" width="678" height="356" class="img_t5GP"></p><p class="caption-center">QPS line graph</p><h3 class="anchor anchorWithHideOnScrollNavbar_dOSS" id="generate-the-report-in-pdf">Generate the report in PDF<a href="#generate-the-report-in-pdf" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h3><p>Currently, there is no available API for generating Chaos Mesh reports or analyzing results. I decided to generate the report in PDF format so it would be readable on different browsers. In my case, I used <a href="https://github.com/signintech/gopdf" target="_blank" rel="noopener noreferrer">gopdf</a>, a support library that allows users to create PDF files. It also lets me insert images or draw tables, which meets my needs.</p><p>To generate a daily report, I used <a href="https://www.linux.org/docs/man8/cron.html" target="_blank" rel="noopener noreferrer">crond</a>, a command-line utility that executes cron jobs in the background, to execute the commands early each morning. So, when I start work, there is a daily report waiting for me.</p><h2 class="anchor anchorWithHideOnScrollNavbar_dOSS" id="build-a-web-application-for-daily-reporting">Build a web application for daily reporting<a href="#build-a-web-application-for-daily-reporting" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>But I want to make the report more readable and accessible. Isn’t it nicer if you can check reports on a web application? At first, I wanted to add a backend API and track when the report was generated. It sounds applicable but it may be too much work since all I want is to know which report requires further troubleshooting. The exact information is shown in the file name, for example: <code>report-2021-07-09-bad.pdf</code>. Thus, the reporting system’s workload and complexity are greatly reduced.</p><p>Still, it is necessary to improve the backend interfaces as well as enrich the report content. But for now, a daily, workable reporting system is just fine.</p><p>In my case, I used <a href="https://github.com/vuejs/vue" target="_blank" rel="noopener noreferrer">Vue.js</a> to scaffold the web application using a UI library <a href="https://www.antdv.com/docs/vue/introduce/" target="_blank" rel="noopener noreferrer">antd</a>. After that, I updated the page content by saving the automatically generated report to the static resources folder <code>static</code>. This allows the web application to read the static reports and then render them to the front end page. For details, check out <a href="https://www.antdv.com/docs/vue/use-with-vue-cli/" target="_blank" rel="noopener noreferrer">Use antd in vue-cli 3</a>.</p><p>Below is an example of a web application that I developed for daily reporting. The red card indicates that I should take a look at the testing report because exceptions are thrown after running chaos experiments.</p><p><img loading="lazy" alt="Web application for daily reporting" src="/zh/assets/images/web-app-for-daily-reporting-3fc7adf871410eb6a52f15ac84c00d5b.png" width="1999" height="580" class="img_t5GP"></p><p class="caption-center">Web application for daily reporting</p><p>Clicking the red card will open the report, as shown below. I used <a href="https://github.com/mozilla/pdf.js" target="_blank" rel="noopener noreferrer">pdf.js</a> to view the PDF.</p><p><img loading="lazy" alt="Daily report in PDF" src="/zh/assets/images/daily-report-pdf-8ae60cf1beb170450c7fd87443084175.png" width="930" height="841" class="img_t5GP"></p><p class="caption-center">Daily report in PDF</p><h2 class="anchor anchorWithHideOnScrollNavbar_dOSS" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to heading" title="Direct link to heading">​</a></h2><p>Chaos Mesh enables you to simulate faults that most cloud-native applications might encounter. In this article, I created a PodChaos experiment and observed that QPS in the TiDB cluster was affected when the Pod became unavailable. After analyzing the logs, I can enhance the robustness and high availability of the system. I built a web application to generate daily reports for troubleshooting and debugging. You can also customize the reports to meet your own requirements.</p><p>Our team is also working on a project to <a href="https://github.com/DigitalChinaOpenSource/TiDB-for-PostgreSQL" target="_blank" rel="noopener noreferrer">make TiDB compatible with PostgreSQL</a>. If you are interested and want to make contributions, you are welcome to pick an issue and get started.</p><p><strong>Originally published at <em><a href="https://thenewstack.io/develop-a-daily-reporting-system-for-chaos-mesh-to-improve-system-resilience/" target="_blank" rel="noopener noreferrer">The New Stack</a></em>.</strong></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_nlmr"><div class="col"><b>Tags:</b><ul class="tags_BPaW padding--none margin-left--sm"><li class="tag_jIiW"><a class="tag_v_4J tagRegular_bL5S" href="/zh/blog/tags/chaos-mesh/">Chaos Mesh</a></li><li class="tag_jIiW"><a class="tag_v_4J tagRegular_bL5S" href="/zh/blog/tags/chaos-engineering/">Chaos Engineering</a></li><li class="tag_jIiW"><a class="tag_v_4J tagRegular_bL5S" href="/zh/blog/tags/use-case/">Use case</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/chaos-mesh/website/edit/master/blog/2022-01-11-develop-a-daily-reporting-system.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_A8kI" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>修改本文</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/blog/experience-as-a-chaos-mesh-lfx-mentee/"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Experience as an LFX Mentee for Chaos Mesh</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/blog/share-your-chaos-mesh-story/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Share your #ChaosMeshStory!</div></a></nav></main><div class="col col--2"><div class="tableOfContents_C37A thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#deploy-chaos-mesh-on-kubernetes" class="table-of-contents__link toc-highlight">Deploy Chaos Mesh on Kubernetes</a></li><li><a href="#deploy-tidb" class="table-of-contents__link toc-highlight">Deploy TiDB</a></li><li><a href="#run-a-chaos-experiment" class="table-of-contents__link toc-highlight">Run a chaos experiment</a></li><li><a href="#generate-daily-report" class="table-of-contents__link toc-highlight">Generate daily report</a><ul><li><a href="#collect-logs" class="table-of-contents__link toc-highlight">Collect logs</a></li><li><a href="#filter-errors-and-warnings" class="table-of-contents__link toc-highlight">Filter errors and warnings</a></li><li><a href="#draw-a-plot" class="table-of-contents__link toc-highlight">Draw a plot</a></li><li><a href="#generate-the-report-in-pdf" class="table-of-contents__link toc-highlight">Generate the report in PDF</a></li></ul></li><li><a href="#build-a-web-application-for-daily-reporting" class="table-of-contents__link toc-highlight">Build a web application for daily reporting</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/quick-start/">快速试用（测试推荐）</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/run-a-chaos-experiment/">运行实验</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/developer-guide-overview/">开发指南概览</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/faqs/">FAQs</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://community.cncf.io/chaos-mesh-community/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_OmM5"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://slack.cncf.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack (#project-chaos-mesh)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_OmM5"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/chaos_mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_OmM5"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/blog/">博客</a></li><li class="footer__item"><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_OmM5"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Thanks</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.netlify.com"><img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>© Chaos Mesh Authors 2021 | Documentation Distributed under CC-BY-4.0 </strong>
        <br>
        <br>
        © 2021 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.
      </div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.516a5d87.js"></script>
<script src="/zh/assets/js/main.3528f3fc.js"></script>
</body>
</html>