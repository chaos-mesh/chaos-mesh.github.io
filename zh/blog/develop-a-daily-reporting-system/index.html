<!doctype html>
<html lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Chaos Mesh RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Chaos Mesh Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-90760217-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Chaos Mesh" href="/zh/opensearch.xml"><title data-react-helmet="true">How to Develop a Daily Reporting System to Track Chaos Testing Results | Chaos Mesh</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://chaos-mesh.org/zh/blog/develop-a-daily-reporting-system/"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="How to Develop a Daily Reporting System to Track Chaos Testing Results | Chaos Mesh"><meta data-react-helmet="true" name="description" content="How to Develop a Daily Reporting System to Track Chaos Testing Results"><meta data-react-helmet="true" property="og:description" content="How to Develop a Daily Reporting System to Track Chaos Testing Results"><meta data-react-helmet="true" property="og:image" content="https://chaos-mesh.org/zh/img/chaos-mesh-digitalchina-banner.png"><meta data-react-helmet="true" name="twitter:image" content="https://chaos-mesh.org/zh/img/chaos-mesh-digitalchina-banner.png"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-01-11T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/lileiaab"><meta data-react-helmet="true" property="article:tag" content="Chaos Mesh,Chaos Engineering,Use case"><link data-react-helmet="true" rel="shortcut icon" href="/zh/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chaos-mesh.org/zh/blog/develop-a-daily-reporting-system/"><link data-react-helmet="true" rel="alternate" href="https://chaos-mesh.org/blog/develop-a-daily-reporting-system/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://chaos-mesh.org/zh/blog/develop-a-daily-reporting-system/" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://chaos-mesh.org/blog/develop-a-daily-reporting-system/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh/assets/css/styles.2c9dc4da.css">
<link rel="preload" href="/zh/assets/js/runtime~main.9d7f2db2.js" as="script">
<link rel="preload" href="/zh/assets/js/main.eb68ffd8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#37b5fb" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">Chaos Mesh is now a CNCF Incubating project 🥳, check out <a href="https://www.cncf.io/blog/2022/02/16/chaos-mesh-moves-to-the-cncf-incubator/" target="_blank">the announcement</a>!</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/logos/logo-mini.svg" alt="Chaos Mesh" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/zh/img/logos/logo-mini-white.svg" alt="Chaos Mesh" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Chaos Mesh</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/zh/docs/">2.1.5</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/">Next</a></li><li><a class="dropdown__link" href="/zh/docs/">2.1.5</a></li><li><a class="dropdown__link" href="/zh/docs/2.0.7/">2.0.7</a></li><li><a class="dropdown__link" href="/zh/docs/1.2.4/">1.2.4</a></li><li><a class="dropdown__link" href="/zh/docs/1.1.4/">1.1.4</a></li><li><a class="dropdown__link" href="/zh/docs/1.0.3/">1.0.3</a></li><li><a class="dropdown__link" href="/zh/docs/0.9.1/">0.9.1</a></li></ul></div><a class="navbar__item navbar__link" href="/zh/docs/">文档</a><a class="navbar__item navbar__link" href="/zh/interactive-tutorial/">交互式教程</a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/blog/">博客</a><a href="https://community.cncf.io/chaos-mesh-community/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>简体中文</span></span></a><ul class="dropdown__menu"><li><a href="/blog/develop-a-daily-reporting-system/" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog/develop-a-daily-reporting-system/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">简体中文</a></li></ul></div><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub"></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">最近的文章</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/experience-as-a-chaos-mesh-lfx-mentee/">Experience as an LFX Mentee for Chaos Mesh</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/zh/blog/develop-a-daily-reporting-system/">How to Develop a Daily Reporting System to Track Chaos Testing Results</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/share-your-chaos-mesh-story/">Share your #ChaosMeshStory!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/deploy-chaos-mesh-on-kubesphere/">Deploy Chaos Mesh on KubeSphere</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh/blog/better-observability-for-chaos-engineering/">Chaos Mesh + SkyWalking: Better Observability for Chaos Engineering</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">How to Develop a Daily Reporting System to Track Chaos Testing Results</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2022-01-11T00:00:00.000Z" itemprop="datePublished">2022年1月11日</time> · <!-- -->One min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/lileiaab" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://avatars.githubusercontent.com/u/88825087?v=4" alt="Lei Li"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/lileiaab" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Lei Li</span></a></div><small class="avatar__subtitle" itemprop="description">Senior software engineer at Digital China</small></div></div></div></div></header><meta itemprop="image" content="https://chaos-mesh.org/zh/img/chaos-mesh-digitalchina-banner.png"><div class="markdown" itemprop="articleBody"><p><img alt="How to Develop a Daily Reporting System to Track Chaos Testing Results" src="/zh/assets/images/chaos-mesh-digitalchina-banner-c7d6ac176f56621aa799af0e30d06e96.png"></p><p>Chaos Mesh is a cloud-native chaos engineering platform that orchestrates chaos experiments on Kubernetes environments. It allows you to test the resilience of your system by simulating problems such as network faults, file system faults, and Pod faults. After each chaos experiment, you can review the testing results by checking the logs. But this is neither direct nor efficient. Therefore, I decided to develop a daily reporting system that would automatically analyze logs and generate reports. This way, it’s easy to examine the logs and identify the issues.</p><p>In this article, I will give you some insights about how to build a daily reporting system, as well as the problems I encountered during the process and how I fixed them.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="deploy-chaos-mesh-on-kubernetes">Deploy Chaos Mesh on Kubernetes<a aria-hidden="true" class="hash-link" href="#deploy-chaos-mesh-on-kubernetes" title="Direct link to heading">​</a></h2><p>Chaos Mesh is designed for Kubernetes, which is one of the important reasons why it can allow users to inject faults into the file system, Pod, or network for specific applications.</p><p>In earlier documents, Chaos Mesh offered two ways to quickly deploy a virtual Kubernetes cluster on your machine: <a href="https://github.com/kubernetes-sigs/kind" target="_blank" rel="noopener noreferrer">kind</a> and <a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener noreferrer">minikube</a>. Generally, it only takes a one-line command to deploy a Kubernetes cluster as well as install Chaos Mesh. But there are some problems:</p><ul><li>Starting Kubernetes clusters locally affects network-related fault types.</li><li>Users on the Chinese mainland might experience an extremely slow process to pull the Docker image or even a timeout.</li></ul><p>If you use the provided script to deploy a Kubernetes cluster using kind, all Kubernetes nodes are virtual machines (VM). This adds difficulty when you pull the image offline. To address this issue, you can deploy the Kubernetes cluster on multiple physical machines instead, with each physical machine acting as a worker node. To expedite the image pulling process, you can use the <code>docker load</code> command to load the required image in advance. Apart from the two problems above, you can install <a href="https://kubernetes.io/docs/reference/kubectl/overview/" target="_blank" rel="noopener noreferrer">kubectl</a> and <a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a> by following the documentation.</p><p>Note: For the latest installation and deployment instructions, refer to <a href="https://chaos-mesh.org/docs/quick-start/" target="_blank" rel="noopener noreferrer">Chaos Mesh Quick Start</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="deploy-tidb">Deploy TiDB<a aria-hidden="true" class="hash-link" href="#deploy-tidb" title="Direct link to heading">​</a></h2><p>The next step is to deploy TiDB on Kubernetes. I used TiDB Operator to streamline the process. For details, check out <a href="https://docs.pingcap.com/tidb-in-kubernetes/stable/get-started" target="_blank" rel="noopener noreferrer">Get started with TiDB Operator in Kubernetes</a>.</p><p>I’d like to highlight two points in this process:</p><ul><li>First, install Custom Resource Definitions (CRDs) to implement different components of TiDB Operator. Otherwise, you’ll get errors when you try to install TiDB Operator.</li><li>Use <a href="https://longhorn.io/" target="_blank" rel="noopener noreferrer">Longhorn</a>, a distributed block storage system for Kubernetes, to create local persistent volumes (PV) for your Kubernetes cluster. This way, you don’t have to create PVs in advance: whenever a Pod is pulled, a PV is automatically created and mounted.</li></ul><p>The biggest problem that I encountered was that pulling the image could be extremely slow when deploying the service. If the nodes in your Kubernetes cluster are virtual machines, pull the required images in advance and load them to the Docker of each machine:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">## Pull required images on a machine with a good network connection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker pull pingcap/tikv:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker pull pingcap/tidb:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker pull pingcap/pd:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">## Export images and save them to each machine in the Kubernetes cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker save -o tikv.tar pingcap/tikv:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker save -o tidb.tar pingcap/tidb:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker save -o pd.tar pingcap/pd:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">## Load images to each machine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker load </span><span class="token operator">&amp;</span><span class="token plain">lt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> tikv.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker load </span><span class="token operator">&amp;</span><span class="token plain">lt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> tidb.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker load </span><span class="token operator">&amp;</span><span class="token plain">lt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> pd.tar</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>The above commands allow you to use the TiDB image in the local Docker registry to deploy the latest TiDB cluster, saving you the trouble of pulling the image from the remote repository. The idea also applies to the Chaos Mesh installation as described earlier. If you do not know which images you need to pull, install Chaos Mesh using Helm to trigger the installation process, then use the <code>kubectl describe</code> command to verify:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">## Check pods that are deployed in a specific namespace.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl describe pods -n tidb-test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>The mirror pulling process usually takes the longest time to complete. If the Pod is being scheduled to a node, check it later.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="run-a-chaos-experiment">Run a chaos experiment<a aria-hidden="true" class="hash-link" href="#run-a-chaos-experiment" title="Direct link to heading">​</a></h2><p>To run a chaos experiment, you have to define it first through YAML files and use <code>kubectl apply</code> to start it. In this example, I created a chaos experiment using PodChaos to simulate a Pod crashing. For detailed instructions, refer to <a href="https://chaos-mesh.org/docs/run-a-chaos-experiment/" target="_blank" rel="noopener noreferrer">Run a Chaos Experiment</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="generate-daily-report">Generate daily report<a aria-hidden="true" class="hash-link" href="#generate-daily-report" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="collect-logs">Collect logs<a aria-hidden="true" class="hash-link" href="#collect-logs" title="Direct link to heading">​</a></h3><p>Usually, when you run chaos experiments on TiDB clusters, many errors are returned. To collect those error logs, run the <code>kubectl logs</code> command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">kubectl logs </span><span class="token operator">&amp;</span><span class="token plain">lt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">podname</span><span class="token operator">&gt;</span><span class="token plain"> -n tidb-test --since</span><span class="token operator">=</span><span class="token plain">24h </span><span class="token operator">&gt;&gt;</span><span class="token plain"> tidb.log</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>All logs generated in the past 24 hours of the specific Pod in the <code>tidb-test</code> namespace will be saved to the <code>tidb.log</code> file.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="filter-errors-and-warnings">Filter errors and warnings<a aria-hidden="true" class="hash-link" href="#filter-errors-and-warnings" title="Direct link to heading">​</a></h3><p>In this step, you have to filter error messages and warning messages from logs. There are two options:</p><ul><li>Use text processing tools, such as awk. This requires a proficient understanding of Linux/Unix commands.</li><li>Write a script. If you’re not familiar with Linux/Unix commands, this is the better option.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="draw-a-plot">Draw a plot<a aria-hidden="true" class="hash-link" href="#draw-a-plot" title="Direct link to heading">​</a></h3><p>For plotting, I used <a href="http://www.gnuplot.info/" target="_blank" rel="noopener noreferrer">gnuplot</a>, a Linux command-line graphing utility. In the example below, I imported the pressure measurement results and created a line graph to show how queries per second (QPS) were affected when a specific Pod became unavailable. Since the chaos experiment was executed periodically, the number of QPS exhibited a pattern: it would drop abruptly and then quickly return to normal.</p><p><img alt="QPS line graph" src="/zh/assets/images/qps-line-graph-10389785bbe639db08850f5d73c47239.png"></p><p class="caption-center">QPS line graph</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="generate-the-report-in-pdf">Generate the report in PDF<a aria-hidden="true" class="hash-link" href="#generate-the-report-in-pdf" title="Direct link to heading">​</a></h3><p>Currently, there is no available API for generating Chaos Mesh reports or analyzing results. I decided to generate the report in PDF format so it would be readable on different browsers. In my case, I used <a href="https://github.com/signintech/gopdf" target="_blank" rel="noopener noreferrer">gopdf</a>, a support library that allows users to create PDF files. It also lets me insert images or draw tables, which meets my needs.</p><p>To generate a daily report, I used <a href="https://www.linux.org/docs/man8/cron.html" target="_blank" rel="noopener noreferrer">crond</a>, a command-line utility that executes cron jobs in the background, to execute the commands early each morning. So, when I start work, there is a daily report waiting for me.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="build-a-web-application-for-daily-reporting">Build a web application for daily reporting<a aria-hidden="true" class="hash-link" href="#build-a-web-application-for-daily-reporting" title="Direct link to heading">​</a></h2><p>But I want to make the report more readable and accessible. Isn’t it nicer if you can check reports on a web application? At first, I wanted to add a backend API and track when the report was generated. It sounds applicable but it may be too much work since all I want is to know which report requires further troubleshooting. The exact information is shown in the file name, for example: <code>report-2021-07-09-bad.pdf</code>. Thus, the reporting system’s workload and complexity are greatly reduced.</p><p>Still, it is necessary to improve the backend interfaces as well as enrich the report content. But for now, a daily, workable reporting system is just fine.</p><p>In my case, I used <a href="https://github.com/vuejs/vue" target="_blank" rel="noopener noreferrer">Vue.js</a> to scaffold the web application using a UI library <a href="https://www.antdv.com/docs/vue/introduce/" target="_blank" rel="noopener noreferrer">antd</a>. After that, I updated the page content by saving the automatically generated report to the static resources folder <code>static</code>. This allows the web application to read the static reports and then render them to the front end page. For details, check out <a href="https://www.antdv.com/docs/vue/use-with-vue-cli/" target="_blank" rel="noopener noreferrer">Use antd in vue-cli 3</a>.</p><p>Below is an example of a web application that I developed for daily reporting. The red card indicates that I should take a look at the testing report because exceptions are thrown after running chaos experiments.</p><p><img alt="Web application for daily reporting" src="/zh/assets/images/web-app-for-daily-reporting-3fc7adf871410eb6a52f15ac84c00d5b.png"></p><p class="caption-center">Web application for daily reporting</p><p>Clicking the red card will open the report, as shown below. I used <a href="https://github.com/mozilla/pdf.js" target="_blank" rel="noopener noreferrer">pdf.js</a> to view the PDF.</p><p><img alt="Daily report in PDF" src="/zh/assets/images/daily-report-pdf-8ae60cf1beb170450c7fd87443084175.png"></p><p class="caption-center">Daily report in PDF</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="summary">Summary<a aria-hidden="true" class="hash-link" href="#summary" title="Direct link to heading">​</a></h2><p>Chaos Mesh enables you to simulate faults that most cloud-native applications might encounter. In this article, I created a PodChaos experiment and observed that QPS in the TiDB cluster was affected when the Pod became unavailable. After analyzing the logs, I can enhance the robustness and high availability of the system. I built a web application to generate daily reports for troubleshooting and debugging. You can also customize the reports to meet your own requirements.</p><p>Our team is also working on a project to <a href="https://github.com/DigitalChinaOpenSource/TiDB-for-PostgreSQL" target="_blank" rel="noopener noreferrer">make TiDB compatible with PostgreSQL</a>. If you are interested and want to make contributions, you are welcome to pick an issue and get started.</p><p><strong>Originally published at <em><a href="https://thenewstack.io/develop-a-daily-reporting-system-for-chaos-mesh-to-improve-system-resilience/" target="_blank" rel="noopener noreferrer">The New Stack</a></em>.</strong></p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/chaos-mesh/">Chaos Mesh</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/chaos-engineering/">Chaos Engineering</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/zh/blog/tags/use-case/">Use case</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/chaos-mesh/website/edit/master/blog/2022-01-11-develop-a-daily-reporting-system.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>修改本文</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh/blog/experience-as-a-chaos-mesh-lfx-mentee/"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« <!-- -->Experience as an LFX Mentee for Chaos Mesh</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh/blog/share-your-chaos-mesh-story/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Share your #ChaosMeshStory!<!-- --> »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#deploy-chaos-mesh-on-kubernetes" class="table-of-contents__link toc-highlight">Deploy Chaos Mesh on Kubernetes</a></li><li><a href="#deploy-tidb" class="table-of-contents__link toc-highlight">Deploy TiDB</a></li><li><a href="#run-a-chaos-experiment" class="table-of-contents__link toc-highlight">Run a chaos experiment</a></li><li><a href="#generate-daily-report" class="table-of-contents__link toc-highlight">Generate daily report</a><ul><li><a href="#collect-logs" class="table-of-contents__link toc-highlight">Collect logs</a></li><li><a href="#filter-errors-and-warnings" class="table-of-contents__link toc-highlight">Filter errors and warnings</a></li><li><a href="#draw-a-plot" class="table-of-contents__link toc-highlight">Draw a plot</a></li><li><a href="#generate-the-report-in-pdf" class="table-of-contents__link toc-highlight">Generate the report in PDF</a></li></ul></li><li><a href="#build-a-web-application-for-daily-reporting" class="table-of-contents__link toc-highlight">Build a web application for daily reporting</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/quick-start/">快速试用（测试推荐）</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/run-a-chaos-experiment/">运行实验</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/developer-guide-overview/">开发指南概览</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/faqs/">FAQs</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/chaos_mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.cncf.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack (#project-chaos-mesh)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://community.cncf.io/chaos-mesh-community/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/zh/blog/">博客</a></li></ul></div><div class="col footer__col"><div class="footer__title">其他</div><ul class="footer__items"><li class="footer__item"><a href="https://www.netlify.com"><img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <br>
        <strong>© Chaos Mesh Authors 2021 | Documentation Distributed under CC-BY-4.0 </strong>
        <br>
        <br>
        © 2021 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.
      </div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.9d7f2db2.js"></script>
<script src="/zh/assets/js/main.eb68ffd8.js"></script>
</body>
</html>