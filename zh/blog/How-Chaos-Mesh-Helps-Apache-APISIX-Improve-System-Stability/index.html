<!doctype html>
<html lang="zh" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">How Chaos Mesh Helps Apache APISIX Improve System Stability | Chaos Mesh</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://chaos-mesh.org/zh/blog/How-Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability/"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="How Chaos Mesh Helps Apache APISIX Improve System Stability | Chaos Mesh"><meta data-rh="true" name="description" content="Chaos Mesh helps Apache APISIX improve system stability"><meta data-rh="true" property="og:description" content="Chaos Mesh helps Apache APISIX improve system stability"><meta data-rh="true" property="og:image" content="https://chaos-mesh.org/zh/img/blog/chaos-mesh-apisix.jpeg"><meta data-rh="true" name="twitter:image" content="https://chaos-mesh.org/zh/img/blog/chaos-mesh-apisix.jpeg"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-08-20T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/Yiyiyimu"><meta data-rh="true" property="article:tag" content="Chaos Mesh,Chaos Engineering"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://chaos-mesh.org/zh/blog/How-Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability/"><link data-rh="true" rel="alternate" href="https://chaos-mesh.org/blog/How-Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability/" hreflang="en"><link data-rh="true" rel="alternate" href="https://chaos-mesh.org/zh/blog/How-Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability/" hreflang="zh"><link data-rh="true" rel="alternate" href="https://chaos-mesh.org/blog/How-Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3BY0S3HQX6-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://chaos-mesh.org/zh/blog/How-Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability","mainEntityOfPage":"https://chaos-mesh.org/zh/blog/How-Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability","url":"https://chaos-mesh.org/zh/blog/How-Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability","headline":"How Chaos Mesh Helps Apache APISIX Improve System Stability","name":"How Chaos Mesh Helps Apache APISIX Improve System Stability","description":"Chaos Mesh helps Apache APISIX improve system stability","datePublished":"2021-08-20T00:00:00.000Z","author":{"@type":"Person","name":"Shuyang Wu","description":"Committer of Chaos Mesh","url":"https://github.com/Yiyiyimu","image":"https://avatars.githubusercontent.com/u/34589752?v=4"},"image":{"@type":"ImageObject","@id":"https://chaos-mesh.org/zh/img/blog/chaos-mesh-apisix.jpeg","url":"https://chaos-mesh.org/zh/img/blog/chaos-mesh-apisix.jpeg","contentUrl":"https://chaos-mesh.org/zh/img/blog/chaos-mesh-apisix.jpeg","caption":"title image for the blog post: How Chaos Mesh Helps Apache APISIX Improve System Stability"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://chaos-mesh.org/zh/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Chaos Mesh RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Chaos Mesh Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-T31S4LR9LL"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-T31S4LR9LL",{})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Chaos Mesh" href="/zh/opensearch.xml">

<link rel="preconnect" href="https://www.clarity.ms">
<script>!function(t,e,n,c,r,s,a){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(s=e.createElement(c)).async=1,s.src="https://www.clarity.ms/tag/lggqck9srz",(a=e.getElementsByTagName(c)[0]).parentNode.insertBefore(s,a)}(window,document,"clarity","script")</script><link rel="stylesheet" href="/zh/assets/css/styles.e99cfd16.css">
<script src="/zh/assets/js/runtime~main.e0983a32.js" defer="defer"></script>
<script src="/zh/assets/js/main.df18e39d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_VprB" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_gm8K"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/logos/logo-mini.svg" alt="Chaos Mesh" class="themedComponent_wXoC themedComponent--light_HvHy"><img src="/zh/img/logos/logo-mini-white.svg" alt="Chaos Mesh" class="themedComponent_wXoC themedComponent--dark_JLbL"></div><b class="navbar__title text--truncate">Chaos Mesh</b></a><a class="navbar__item navbar__link" href="/zh/docs/">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/blog/">博客</a><a href="https://community.cncf.io/chaos-mesh-community/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">社团<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_WtTX"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/docs/">2.7.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/">Next</a></li><li><a class="dropdown__link" href="/zh/docs/">2.7.0</a></li><li><a class="dropdown__link" href="/zh/docs/2.6.5/">2.6.5</a></li><li><a class="dropdown__link" href="/zh/docs/2.5.2/">2.5.2</a></li><li class=""><hr style="margin: .5em 0;"></li><li><a class="dropdown__link" href="/zh/versions/">All Versions</a></li><li><a class="dropdown__link" href="/zh/supported-releases/">Supported Releases</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_xvpk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/blog/How-Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/blog/How-Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub"></a><div class="toggle_JMiF colorModeToggle_VyTq"><button class="clean-btn toggleButton_R5El toggleButtonDisabled_ni1X" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_UtZQ"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_hr4M"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_lWAT"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_ZIuv"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_eAMg thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_cVoO margin-bottom--md">最近的文章</div><div role="group"><h3 class="yearGroupHeading_Nx7u">2022</h3><ul class="sidebarItemList_bJt8 clean-list"><li class="sidebarItem_Ttzz"><a class="sidebarItemLink_TQJ7" href="/zh/blog/chaos-mesh-qa-at-kubecon-eu-2022/">Chaos Mesh Q&amp;A at KUBECON EU 2022</a></li><li class="sidebarItem_Ttzz"><a class="sidebarItemLink_TQJ7" href="/zh/blog/experience-as-a-chaos-mesh-lfx-mentee/">Experience as an LFX Mentee for Chaos Mesh</a></li><li class="sidebarItem_Ttzz"><a class="sidebarItemLink_TQJ7" href="/zh/blog/develop-a-daily-reporting-system/">How to Develop a Daily Reporting System to Track Chaos Testing Results</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_Nx7u">2021</h3><ul class="sidebarItemList_bJt8 clean-list"><li class="sidebarItem_Ttzz"><a class="sidebarItemLink_TQJ7" href="/zh/blog/share-your-chaos-mesh-story/">Share your #ChaosMeshStory!</a></li><li class="sidebarItem_Ttzz"><a class="sidebarItemLink_TQJ7" href="/zh/blog/deploy-chaos-mesh-on-kubesphere/">Deploy Chaos Mesh on KubeSphere</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_ZFnQ">How Chaos Mesh Helps Apache APISIX Improve System Stability</h1><div class="container_AKGX margin-vert--md"><time datetime="2021-08-20T00:00:00.000Z">2021年8月20日</time> · <!-- -->阅读需 6 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_VHX3"><div class="avatar margin-bottom--sm"><a href="https://github.com/Yiyiyimu" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_j0s_" src="https://avatars.githubusercontent.com/u/34589752?v=4" alt="Shuyang Wu"></a><div class="avatar__intro authorDetails_ou41"><div class="avatar__name"><a href="https://github.com/Yiyiyimu" target="_blank" rel="noopener noreferrer"><span class="authorName_IzGa">Shuyang Wu</span></a></div><small class="authorTitle_VR7C" title="Committer of Chaos Mesh">Committer of Chaos Mesh</small><div class="authorSocials_k6N5"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p></p><figure><img decoding="async" loading="lazy" alt="Chaos Mesh helps Apache APISIX improve system stability" src="/zh/assets/images/chaos-mesh-apisix-f1e9d2b36bf99249ad8fff26d94e0009.jpeg" width="3126" height="1043" class="img_xWZi"><figcaption class="text--italic text--center" style="color:var(--ifm-color-content-secondary);font-size:0.875rem">Chaos Mesh helps Apache APISIX improve system stability</figcaption></figure><p></p>
<p><a href="https://github.com/apache/apisix" target="_blank" rel="noopener noreferrer">Apache APISIX</a> is a cloud-native, high-performance, scaling microservices API gateway. It is one of the Apache Software Foundation&#x27;s top-level projects and serves hundreds of companies around the world, processing their mission-critical traffic, including finance, the Internet, manufacturing, retail, and operators. Our customers include NASA, the European Union&#x27;s digital factory, China Mobile, and Tencent.</p>
<p>As our community grows, Apache APISIX&#x27;s features more frequently interact with external components, making our system more complex and increasing the possibility of errors. To identify potential system failures and build confidence in the production environment, we introduced the concept of Chaos Engineering.</p>
<p></p><figure><img decoding="async" loading="lazy" alt="Apache APISIX architecture" src="/zh/assets/images/apache-apisix-architecture-16026d6248e9c7ea47943b6105163d84.jpg" width="1080" height="510" class="img_xWZi"><figcaption class="text--italic text--center" style="color:var(--ifm-color-content-secondary);font-size:0.875rem">Apache APISIX architecture</figcaption></figure><p></p>
<p>In this post, we&#x27;ll share how we use <a href="https://chaos-mesh.org/" target="_blank" rel="noopener noreferrer">Chaos Mesh</a> to improve our system stability.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_xHUa" id="our-pain-points">Our pain points<a href="#our-pain-points" class="hash-link" aria-label="Our pain points的直接链接" title="Our pain points的直接链接">​</a></h2>
<p>Apache APISIX processes tens of billions of requests a day. At that volume level, our users have noticed a couple of issues:</p>
<ul>
<li><strong>Scenario #1:</strong> In Apache APISIX&#x27;s configuration center, when unexpectedly high network latency occurs between etcd and Apache APISIX, can Apache APISIX still filter and forward traffic normally?</li>
<li><strong>Scenario #2:</strong> When a node in the etcd cluster fails and the cluster can still run normally, an error is reported for the node&#x27;s interaction with the Apache APISIX admin API.</li>
</ul>
<p>Although Apache APISIX has covered many scenarios through unit, end-to-end (E2E), and fuzz tests in continuous integration (CI), it has not covered the interaction scenario with external components. If the system behaves abnormally, for example, if the network jitters, a hard disk fails, or a process is killed, can Apache APISIX give appropriate error messages? Can it keep running or restore itself to normal operation?</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_xHUa" id="why-we-chose-chaos-mesh">Why we chose Chaos Mesh<a href="#why-we-chose-chaos-mesh" class="hash-link" aria-label="Why we chose Chaos Mesh的直接链接" title="Why we chose Chaos Mesh的直接链接">​</a></h2>
<p>To test these user scenarios and to discover similar problems before our product goes into production, our community decided to use Chaos Mesh for chaos testing.</p>
<p>Chaos Mesh is a cloud-native Chaos Engineering platform that features all-around fault injection methods for complex systems on Kubernetes, covering faults in Pod, the network, file system, and even the kernel. It helps users find weaknesses in the system and ensures that the system can resist out-of-control situations in the production environment.</p>
<p>Like Apache APISIX, Chaos Mesh has an active open source community. We know that an active community can ensure stable software use and rapid iteration. This makes Chaos Mesh more attractive.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_xHUa" id="how-we-use-chaos-mesh-in-apisix">How we use Chaos Mesh in APISIX<a href="#how-we-use-chaos-mesh-in-apisix" class="hash-link" aria-label="How we use Chaos Mesh in APISIX的直接链接" title="How we use Chaos Mesh in APISIX的直接链接">​</a></h2>
<p>Chaos Engineering has grown beyond simple fault injection and now forms a complete methodology. To create a chaos experiment, we determined what the normal operation or &quot;steady state&quot; of our application should be. We then introduced potential problems to see how the system responded. If the problems knocked the application out of its steady state, we fixed them.</p>
<p>Now, we&#x27;ll take the two scenarios we mentioned to show you how we use Chaos Mesh in Apache APISIX.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_xHUa" id="scenario-1">Scenario #1<a href="#scenario-1" class="hash-link" aria-label="Scenario #1的直接链接" title="Scenario #1的直接链接">​</a></h3>
<p>We deployed a Chaos Engineering experiment using the following steps:</p>
<ol>
<li>
<p>We found metrics to measure whether Apache APISIX is running normally. In the test, the most important method is to use Grafana to monitor the Apache APISIX&#x27;s running metrics. We extracted data from Prometheus in CI for comparison. Here, we used the routing and forwarding requests per second (RPS) and etcd connectivity as evaluation metrics. We analyzed the log. For Apache APISIX, we checked Nginx&#x27;s error log to determine whether there was an error and whether the error was in line with our expectations.</p>
</li>
<li>
<p>We performed a test in the control group. We found that both <code>create route</code> and <code>access route</code> were successful, and we could connect to etcd. We recorded the RPS.</p>
</li>
<li>
<p>We used network chaos to add a five second network latency and then retested. This time, <code>set route</code> failed, <code>get route</code> succeeded, etcd could be connected to, and RPS had no significant change compared to the previous experiment. The experiment met our expectations.</p>
</li>
</ol>
<p></p><figure><img decoding="async" loading="lazy" alt="High network latency occurs between etcd and Apache APISIX" src="/zh/assets/images/high-network-latency-between-etcd-and-apache-apisix-9d036984f06e3f53e2f030428ccf917e.jpg" width="1080" height="1016" class="img_xWZi"><figcaption class="text--italic text--center" style="color:var(--ifm-color-content-secondary);font-size:0.875rem">High network latency occurs between etcd and Apache APISIX</figcaption></figure><p></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_xHUa" id="scenario-2">Scenario #2<a href="#scenario-2" class="hash-link" aria-label="Scenario #2的直接链接" title="Scenario #2的直接链接">​</a></h3>
<p>After we conducted the same experiment as above in the control group, we introduced pod-kill chaos and reproduced the expected error. When we randomly deleted a small number of etcd nodes in the cluster, sometimes APISIX could connect to etcd and sometimes not, and the log printed a large number of connection rejection errors.</p>
<p>When we deleted the first or third node in the etcd endpoint list, the <code>set route</code> returned a result normally. However, when we deleted the second node in the list, the <code>set route</code> returned the error &quot;connection refused.&quot;</p>
<p>Our troubleshooting revealed that the etcd Lua API used by Apache APISIX selected the endpoint sequentially, not randomly. Therefore, when we created an etcd client, we bound to only one etcd endpoint. This led to continuous failure.</p>
<p>After we fixed this problem, we added a health check to the etcd Lua API to ensure that a large number of requests would not be sent to the disconnected etcd node. To avoid flooding the log with errors, we added a fallback mechanism when the etcd cluster was completely disconnected.</p>
<p></p><figure><img decoding="async" loading="lazy" alt="Error Reported from etcd Node Interaction" src="/zh/assets/images/error-reported-from-etcd-node-interaction-529a2e15e86ca5b3cb347db0f13a751b.jpg" width="1080" height="1149" class="img_xWZi"><figcaption class="text--italic text--center" style="color:var(--ifm-color-content-secondary);font-size:0.875rem">Error Reported from etcd Node Interaction</figcaption></figure><p></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_xHUa" id="our-future-plans">Our future plans<a href="#our-future-plans" class="hash-link" aria-label="Our future plans的直接链接" title="Our future plans的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_xHUa" id="run-a-chaos-test-in-e2e-simulation-scenarios">Run a chaos test in E2E simulation scenarios<a href="#run-a-chaos-test-in-e2e-simulation-scenarios" class="hash-link" aria-label="Run a chaos test in E2E simulation scenarios的直接链接" title="Run a chaos test in E2E simulation scenarios的直接链接">​</a></h3>
<p>In Apache APISIX, we manually identify system weaknesses for testing and repair. As in the open source community, we test in CI, so we don&#x27;t need to worry about the impact of Chaos Engineering&#x27;s failure radius on the production environment. But the test cannot cover complicated and comprehensive application scenarios in the production environment.</p>
<p>To cover more scenarios, the community plans to use the existing E2E test to simulate more complete scenarios and conduct chaos tests that are more random and cover a larger range.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_xHUa" id="add-chaos-tests-to-more-apache-apisix-projects">Add chaos tests to more Apache APISIX projects<a href="#add-chaos-tests-to-more-apache-apisix-projects" class="hash-link" aria-label="Add chaos tests to more Apache APISIX projects的直接链接" title="Add chaos tests to more Apache APISIX projects的直接链接">​</a></h3>
<p>In addition to finding more vulnerabilities for Apache APISIX, the community plans to add chaos tests to more projects such as Apache APISIX Dashboard and Apache APISIX Ingress Controller.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_xHUa" id="add-features-to-chaos-mesh">Add features to Chaos Mesh<a href="#add-features-to-chaos-mesh" class="hash-link" aria-label="Add features to Chaos Mesh的直接链接" title="Add features to Chaos Mesh的直接链接">​</a></h3>
<p>When we deployed Chaos Mesh, some features were temporarily unsupported. For example, we couldn&#x27;t select a service as a network latency target or specify container port injection as network chaos. In the future, the Apache APISIX community will assist Chaos Mesh to add related features.</p>
<p>You&#x27;re welcome to contribute to the <a href="https://github.com/apache/apisix" target="_blank" rel="noopener noreferrer">Apache APISIX project</a> on GitHub. If you are interested in Chaos Mesh and would like to improve it, join our <a href="https://slack.cncf.io/" target="_blank" rel="noopener noreferrer">Slack channel</a> (#project-chaos-mesh) or submit your pull requests or issues to our <a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer">GitHub repository</a>.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>标签：</b><ul class="tags_GlUk padding--none margin-left--sm"><li class="tag_ndSj"><a class="tag_Tyas tagRegular_GbUB" href="/zh/blog/tags/chaos-mesh/">Chaos Mesh</a></li><li class="tag_ndSj"><a class="tag_Tyas tagRegular_GbUB" href="/zh/blog/tags/chaos-engineering/">Chaos Engineering</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/chaos-mesh/website/edit/master/blog/2021-08-20-chaos-mesh-apisix.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_h6an" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_WwaV"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/blog/Securing-Online-Gaming-Combine-Chaos-Engineering-with-DevOps-Practices/"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">Securing Online Gaming: Combine Chaos Engineering with DevOps Practices</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/blog/chaos-mesh-2.0-to-a-chaos-engineering-ecology/"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">Chaos Mesh 2.0: To a Chaos Engineering Ecology</div></a></nav></main><div class="col col--2"><div class="tableOfContents_cNUy thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#our-pain-points" class="table-of-contents__link toc-highlight">Our pain points</a></li><li><a href="#why-we-chose-chaos-mesh" class="table-of-contents__link toc-highlight">Why we chose Chaos Mesh</a></li><li><a href="#how-we-use-chaos-mesh-in-apisix" class="table-of-contents__link toc-highlight">How we use Chaos Mesh in APISIX</a><ul><li><a href="#scenario-1" class="table-of-contents__link toc-highlight">Scenario #1</a></li><li><a href="#scenario-2" class="table-of-contents__link toc-highlight">Scenario #2</a></li></ul></li><li><a href="#our-future-plans" class="table-of-contents__link toc-highlight">Our future plans</a><ul><li><a href="#run-a-chaos-test-in-e2e-simulation-scenarios" class="table-of-contents__link toc-highlight">Run a chaos test in E2E simulation scenarios</a></li><li><a href="#add-chaos-tests-to-more-apache-apisix-projects" class="table-of-contents__link toc-highlight">Add chaos tests to more Apache APISIX projects</a></li><li><a href="#add-features-to-chaos-mesh" class="table-of-contents__link toc-highlight">Add features to Chaos Mesh</a></li></ul></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/quick-start/">快速试用</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/run-a-chaos-experiment/">运行实验</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/developer-guide-overview/">开发指南概览</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/faqs/">常见问题</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/blog/">博客</a></li><li class="footer__item"><a href="https://community.cncf.io/chaos-mesh-community/" target="_blank" rel="noopener noreferrer" class="footer__link-item">CNCF 社团<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_WtTX"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/chaos-mesh/chaos-mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_WtTX"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://slack.cncf.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack (#project-chaos-mesh)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_WtTX"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/chaos_mesh" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_WtTX"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">致谢</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://storyset.com/technology" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks for the technology illustrations by Storyset<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_WtTX"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                <a href="https://www.netlify.com">
                  <img src="https://www.netlify.com/v3/img/components/netlify-color-bg.svg" alt="Deploys by Netlify">
                </a>
              </li><li class="footer__item">
                <img referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=3103bfa4-2073-4b9a-bdac-f36f63d979a4">
              </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <p style="font-weight: 500;">Copyright © Chaos Mesh Authors 2024 | Documentation Distributed under CC-BY-4.0</p>
        © 2024 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.
      </div></div></div></footer></div>
</body>
</html>